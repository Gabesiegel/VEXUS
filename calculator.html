<!DOCTYPE HTML>
<html lang="en">
<head>
    <title>VExUS AI - Calculator</title>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no" />
    
    <!-- Phantom Template CSS -->
    <link rel="stylesheet" href="html5up-phantom/assets/css/main.css" />
    <link rel="stylesheet" href="html5up-phantom/assets/css/fontawesome-all.min.css" />
    <noscript><link rel="stylesheet" href="html5up-phantom/assets/css/noscript.css" /></noscript>
    
    <!-- TensorFlow.js -->
    <script src="https://cdn.jsdelivr.net/npm/@tensorflow/tfjs"></script>
    
    <style>
        /* [Previous styles remain the same until input-controls] */
        
        .input-controls {
            width: 90%;
            max-width: 600px;
            margin: 20px auto;
            text-align: center;
            background: rgba(255, 255, 255, 0.95);
            padding: 20px;
            border-radius: 8px;
            border: 1px solid #e0e0e0;
            box-shadow: 0 2px 4px rgba(0,0,0,0.05);
        }

        .input-controls input[type="file"] {
            background: white;
            border: 2px dashed #ccc;
            padding: 15px;
            border-radius: 8px;
            width: 100%;
            cursor: pointer;
            margin: 10px 0;
            transition: border-color 0.3s ease;
        }

        .input-controls input[type="file"]:hover {
            border-color: #007bff;
        }

        /* [Rest of the existing styles remain the same] */
    </style>
</head>
<body class="is-preload">
    <!-- [All existing body content remains the same until before closing body tag] -->

    <!-- Scripts -->
    <script src="html5up-phantom/assets/js/jquery.min.js"></script>
    <script src="html5up-phantom/assets/js/browser.min.js"></script>
    <script src="html5up-phantom/assets/js/breakpoints.min.js"></script>
    <script src="html5up-phantom/assets/js/util.js"></script>
    <script src="html5up-phantom/assets/js/main.js"></script>

    <!-- Add model loading and processing script -->
    <script>
        // Model loading and initialization
        let model;
        async function loadModel() {
            try {
                const statusDiv = document.getElementById('model-status');
                statusDiv.className = 'status-box';
                statusDiv.textContent = 'Loading model...';
                
                // Load the model from your repository's model directory
                model = await tf.loadLayersModel('model/model.json');
                
                statusDiv.className = 'status-box status-ready';
                statusDiv.textContent = 'Model loaded successfully';
            } catch (error) {
                const statusDiv = document.getElementById('model-status');
                statusDiv.className = 'status-box status-error';
                statusDiv.textContent = 'Error loading model: ' + error.message;
            }
        }

        // Image processing function
        async function processImage(file) {
            if (!model) {
                alert('Please wait for the model to load');
                return;
            }

            const img = new Image();
            img.src = URL.createObjectURL(file);
            
            img.onload = async () => {
                // Convert image to tensor and preprocess
                const tensor = tf.browser.fromPixels(img)
                    .resizeNearestNeighbor([224, 224])
                    .toFloat()
                    .expandDims();
                
                // Make prediction
                const prediction = await model.predict(tensor).data();
                
                // Display results
                document.getElementById('result').textContent = 'Processing complete!';
                document.getElementById('top-results').textContent = `Predictions: ${prediction.toString()}`;
                
                // Clean up
                tensor.dispose();
            };
        }

        // Calculate VExUS score function (keep existing if present, or add this)
        function calculateVexusScore() {
            const ivcDiameter = parseFloat(document.getElementById('ivc-diameter').value) || 0;
            const hvScore = parseInt(document.getElementById('hv-score').value) || 0;
            const pvScore = parseInt(document.getElementById('pv-score').value) || 0;
            const rvScore = parseInt(document.getElementById('rv-score').value) || 0;
            
            const totalScore = hvScore + pvScore + rvScore;
            document.getElementById('total-score').textContent = totalScore;
        }

        // Reset scores function
        function resetScores() {
            document.getElementById('ivc-diameter').value = '';
            document.getElementById('hv-score').value = '';
            document.getElementById('pv-score').value = '';
            document.getElementById('rv-score').value = '';
            document.getElementById('total-score').textContent = '--';
        }

        // Event listeners
        document.addEventListener('DOMContentLoaded', () => {
            loadModel(); // Load model when page loads
            
            // Set up file input listener
            const imageUpload = document.getElementById('imageUpload');
            imageUpload.addEventListener('change', (e) => {
                if (e.target.files[0]) {
                    processImage(e.target.files[0]);
                }
            });
        });
    </script>
</body>
</html>
