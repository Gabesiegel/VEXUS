<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>VEXUS AI - Image Recognition</title>
    <script src="https://cdn.jsdelivr.net/npm/@tensorflow/tfjs"></script>
    <style>
        body {
            font-family: Arial, sans-serif;
            text-align: center;
            margin: 20px;
        }
        #imagePreview {
            max-width: 300px;
            margin: 20px auto;
            display: block;
        }
        #logo {
            width: 100px;
            margin: 20px auto;
            display: block;
        }
    </style>
</head>
<body>
    <img id="logo" src="images/vexus-ai-logo.png" alt="VEXUS AI Logo">
    <h1>VEXUS AI - Image Recognition</h1>
    <p>Upload an image to get predictions:</p>
    <input type="file" id="imageUpload" accept="image/*">
    <img id="imagePreview" alt="Image Preview">
    <p id="result">Prediction will appear here...</p>
    
    <script>
        let model;
        
        async function loadModel() {
            try {
                console.log("Loading model...");
                const modelUrl = "https://raw.githubusercontent.com/Gabesiegel/VEXUS/refs/heads/main/model.json";
                model = await tf.loadLayersModel(modelUrl);
                console.log("Model loaded successfully.");
            } catch (error) {
                console.error("Error loading model:", error);
                document.getElementById('result').innerText = "Error loading model! Check model path.";
            }
        }
        
        document.getElementById('imageUpload').addEventListener('change', async function(event) {
            const file = event.target.files[0];
            if (!file) return;
            
            const img = document.getElementById('imagePreview');
            img.src = URL.createObjectURL(file);
            
            img.onload = async function() {
                console.log("Image loaded, making prediction...");
                setTimeout(async () => {
                    try {
                        if (!model) {
                            document.getElementById('result').innerText = "Model not loaded!";
                            return;
                        }
                        
                        const tensor = tf.browser.fromPixels(img)
                            .resizeNearestNeighbor([224, 224])
                            .toFloat()
                            .expandDims();
                        
                        const predictions = await model.predict(tensor).data();
                        console.log("Predictions:", predictions);
                        
                        const labels = ["HV NORMAL", "HV: SEVERE"];
                        const maxIndex = predictions.indexOf(Math.max(...predictions));
                        
                        document.getElementById('result').innerText = `Prediction: ${labels[maxIndex]} (${(predictions[maxIndex] * 100).toFixed(2)}%)`;
                    } catch (error) {
                        console.error("Error during prediction:", error);
                        document.getElementById('result').innerText = "Error making prediction!";
                    }
                }, 500);
            };
        });
        
        loadModel();
    </script>
</body>
</html>
