<!DOCTYPE HTML>
<html lang="en">
<head>
    <title>VExUS ATLAS - Image Gallery</title>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no" />
    <!-- Phantom Template CSS -->
    <link rel="stylesheet" href="html5up-phantom/assets/css/main.css" />
    <link rel="stylesheet" href="html5up-phantom/assets/css/fontawesome-all.min.css" />
    <link rel="stylesheet" href="html5up-phantom/assets/css/mobile.css" />
    <noscript><link rel="stylesheet" href="html5up-phantom/assets/css/noscript.css" /></noscript>

    <style>
        .container {
            width: 100%;
            max-width: 1400px;
            background: #fff;
            padding: 60px;
            margin: 20px auto;
            border-radius: 10px;
            box-shadow: 0 0 10px rgba(0,0,0,0.1);
        }
        .logo-container {
            display: flex;
            justify-content: center;
            align-items: center;
            gap: 60px;
            margin-bottom: 2em;
            flex-wrap: wrap;
        }
        .logo {
            width: 500px;
            height: 250px;
            object-fit: contain;
        }
        .sidebar-logo {
            width: 100px;
            height: auto;
            margin-bottom: 0;
            padding: 5px;
        }
        /* Menu Navigation Styles */
        nav#menu {
            background: #ffffff;
            padding: 20px;
            box-shadow: 0 0 10px rgba(0, 0, 0, 0.1);
        }

        nav#menu .logo-container {
            padding: 10px;
            display: flex;
            justify-content: center;
        }

        nav#menu h2 {
            color: #888888;
            margin-bottom: 1em;
            font-size: inherit;
        }

        nav#menu ul li {
            border-top: solid 1px rgba(0, 0, 0, 0.1);
            padding: 0.5em 0;
        }

        nav#menu ul li a {
            color: #888888 !important;
            text-decoration: none;
            border-bottom: none;
            font-size: 0.9em;
            transition: color 0.2s ease;
        }

        nav#menu ul li a:hover {
            color: #777777 !important;
        }

        .title-container {
            text-align: center;
            margin: 2em 0;
        }
        .title-container h1 {
            font-size: 3.5em;
            margin-bottom: 0.2em;
        }

        /* Gallery Grid Styles */
        .gallery-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(240px, 1fr));
            gap: 20px;
            margin-top: 30px;
        }

        .gallery-item {
            background: #fff;
            border-radius: 15px;
            overflow: hidden;
            box-shadow: 0 4px 15px rgba(0,0,0,0.08);
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            position: relative;
            cursor: pointer;
        }

        .gallery-item:hover {
            transform: translateY(-5px);
            box-shadow: 0 8px 25px rgba(0,0,0,0.12);
        }

        .gallery-item img {
            width: 100%;
            height: 180px;
            object-fit: cover;
            border-radius: 15px 15px 0 0;
            transition: all 0.3s ease;
        }

        .gallery-item:hover img {
            transform: scale(1.05);
        }

        .gallery-item-content {
            padding: 15px;
        }

        .gallery-item h3 {
            margin: 0 0 8px 0;
            font-size: 1.3em;
            color: #333;
            font-weight: 600;
        }

        .gallery-item .caption {
            color: #666;
            font-size: 0.9em;
            margin-bottom: 10px;
        }

        .gallery-item-tags {
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
            margin-top: 12px;
        }

        .gallery-tag {
            font-size: 0.8em;
            padding: 4px 10px;
            border-radius: 12px;
            background: #f5f5f5;
            color: #555;
            font-weight: 500;
        }

        .gallery-tag.quality {
            background: #e3f2fd;
            color: #1976d2;
        }

        .gallery-tag.vein {
            background: #f3e5f5;
            color: #7b1fa2;
        }

        .gallery-tag.waveform {
            background: #e8f5e9;
            color: #2e7d32;
        }

        /* Modal Improvements */
        .modal {
            display: none;
            position: fixed;
            z-index: 1000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            overflow: auto;
            backdrop-filter: blur(5px);
            background-color: rgba(0,0,0,0.85);
            transition: all 0.3s ease;
            opacity: 0;
        }

        .modal.show {
            opacity: 1;
        }

        .modal-content {
            background: #fff;
            border-radius: 20px;
            padding: 25px;
            max-width: 1000px;
            margin: 40px auto;
            position: relative;
            transform: translateY(20px);
            opacity: 0;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        }

        .modal.show .modal-content {
            transform: translateY(0);
            opacity: 1;
        }

        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }

        .modal-title {
            font-size: 1.8em;
            color: #333;
            margin: 0;
        }

        .close {
            position: absolute;
            top: 20px;
            right: 20px;
            width: 40px;
            height: 40px;
            background: rgba(255,255,255,0.9);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: all 0.2s ease;
            color: #333;
            font-size: 24px;
        }

        .close:hover {
            background: #fff;
            transform: rotate(90deg);
        }

        .prev, .next {
            position: absolute;
            top: 50%;
            transform: translateY(-50%);
            width: 50px;
            height: 50px;
            background: rgba(255,255,255,0.9);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: all 0.2s ease;
            z-index: 1000;
        }

        .prev {
            left: 20px;
        }

        .next {
            right: 20px;
        }

        .prev:hover, .next:hover {
            background: #fff;
            transform: translateY(-50%) scale(1.1);
        }

        .slideshow-content img {
            border-radius: 10px;
            max-height: 70vh;
            object-fit: contain;
        }

        /* Sub-tiles modernization */
        .sub-tiles {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(220px, 1fr));
            gap: 20px;
            padding: 15px 0;
        }

        .sub-tile {
            background: #fff;
            border-radius: 15px;
            overflow: hidden;
            box-shadow: 0 4px 15px rgba(0,0,0,0.08);
            transition: all 0.3s ease;
        }

        .sub-tile:hover {
            transform: translateY(-5px);
            box-shadow: 0 8px 25px rgba(0,0,0,0.12);
        }

        .sub-tile img {
            width: 100%;
            height: 180px;
            object-fit: cover;
            transition: all 0.3s ease;
        }

        .sub-tile:hover img {
            transform: scale(1.05);
        }

        .sub-tile p {
            padding: 12px;
            margin: 0;
            font-size: 1em;
            color: #333;
            text-align: center;
            font-weight: 500;
        }

        @media screen and (max-width: 768px) {
            .gallery-grid {
                grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
                gap: 20px;
                padding: 15px;
            }

            .gallery-item img {
                height: 180px;
            }

            .modal-content {
                margin: 20px;
                padding: 20px;
            }

            .prev, .next {
                width: 40px;
                height: 40px;
            }
        }

        .user-info {
            position: fixed;
            bottom: 10px;
            right: 10px;
            background: rgba(255,255,255,0.9);
            padding: 10px;
            border-radius: 5px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
            font-size: 0.8em;
            color: #888;
        }

        /* Gallery Submission Form Styles */
        .form-container {
            max-width: 800px;
            margin: 0 auto;
            padding: 25px;
            border-radius: 10px;
            background: white;
        }

        .upload-area {
            width: 90%;
            max-width: 600px;
            margin: 15px auto;
            border: 2px dashed #ccc;
            border-radius: 10px;
            padding: 30px 20px;
            background: transparent;
            cursor: pointer;
            transition: all 0.2s ease;
            text-align: center;
        }
        
        .upload-area:hover {
            border-color: #999;
        }

        .upload-icon {
            font-size: 2.5em;
            color: #666666;
            margin-bottom: 10px;
        }

        .upload-text {
            font-family: "Source Sans Pro", Helvetica, sans-serif;
            font-weight: 300;
            font-size: 1.1em;
            color: #666666;
            margin-bottom: 15px;
        }

        .file-input {
            display: none;
        }

        .image-preview-container {
            position: relative;
            max-width: 100%;
            margin: 25px auto;
            border-radius: 8px;
            overflow: hidden;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
            transition: all 0.3s ease;
            text-align: center;
            display: flex;
            justify-content: center;
        }
        
        .image-preview {
            max-width: 100%;
            max-height: 250px;
            margin: 0 auto;
            display: none;
            border: none;
            border-radius: 8px;
        }
        
        .image-preview-controls {
            position: absolute;
            top: 10px;
            right: 10px;
            background-color: rgba(0, 0, 0, 0.6);
            padding: 8px;
            border-radius: 50%;
            cursor: pointer;
            transition: all 0.3s ease;
            width: 32px;
            height: 32px;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        .image-preview-controls:hover {
            background-color: rgba(0, 0, 0, 0.8);
            transform: scale(1.1);
        }
        
        .image-preview-delete {
            color: white;
            font-size: 16px;
            line-height: 1;
        }

        .success-message {
            display: none;
            text-align: center;
            color: #4CAF50;
            padding: 15px;
            margin-top: 20px;
            border-radius: 5px;
            background-color: rgba(76, 175, 80, 0.1);
        }

        .error-message {
            display: none;
            text-align: center;
            color: #f44336;
            padding: 15px;
            margin-top: 20px;
            border-radius: 5px;
            background-color: rgba(244, 67, 54, 0.1);
        }

        input[type="text"],
        input[type="email"],
        textarea {
            width: 100%;
            padding: 8px 15px;
            margin-bottom: 1em;
            border: 1px solid #777777;
            border-radius: 5px;
            background-color: transparent;
            color: #777777;
            transition: all 0.3s ease;
            font-family: "Source Sans Pro", Helvetica, sans-serif;
            font-size: 1em;
        }

        input[type="text"]:focus,
        input[type="email"]:focus,
        textarea:focus {
            background-color: rgba(119, 119, 119, 0.1);
            outline: none;
        }

        button[type="submit"] {
            display: inline-block;
            padding: 8px 15px;
            background: transparent;
            color: #777777;
            border: 1px solid #777777;
            border-radius: 5px;
            text-decoration: none;
            transition: all 0.3s ease;
            font-size: 0.9em;
            cursor: pointer;
            font-family: "Source Sans Pro", Helvetica, sans-serif;
        }

        button[type="submit"]:hover {
            background: rgba(119, 119, 119, 0.1);
            transform: translateY(-2px);
        }

        form label {
            display: block;
            margin-top: 1em;
            margin-bottom: 0.5em;
            font-weight: 600;
            color: #2c3e50;
        }

        /* Mobile-optimized gallery styles */
        @media screen and (max-width: 980px) {
            .gallery-grid {
                grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
                gap: 15px;
                padding: 15px;
            }

            .gallery-item {
                aspect-ratio: 1;
                margin-bottom: 15px;
            }

            .gallery-image {
                height: 100%;
                object-fit: cover;
            }

            .image-modal {
                padding: 10px;
            }

            .modal-content {
                max-width: 95%;
                max-height: 90vh;
            }
        }

        @media screen and (max-width: 480px) {
            .gallery-grid {
                grid-template-columns: repeat(auto-fill, minmax(150px, 1fr));
                gap: 10px;
                padding: 10px;
            }

            .gallery-caption {
                font-size: 0.9em;
                padding: 8px;
            }

            .modal-caption {
                font-size: 0.95em;
                padding: 10px;
            }

            .close-button {
                top: 10px;
                right: 10px;
                padding: 8px;
                font-size: 1.2em;
            }
        }

        /* Touch-specific improvements */
        @media (hover: none) {
            .gallery-item {
                -webkit-tap-highlight-color: rgba(0,0,0,0);
            }

            .gallery-item:active {
                transform: scale(0.98);
            }

            .close-button {
                padding: 15px;  /* Larger touch target */
            }

            /* Show captions by default on mobile */
            .gallery-caption {
                opacity: 1;
                transform: none;
            }
        }

        /* Lazy loading improvements */
        .gallery-image {
            transition: opacity 0.3s ease;
            opacity: 0;
        }

        .gallery-image.loaded {
            opacity: 1;
        }

        /* Smooth scrolling for iOS */
        .gallery-grid {
            -webkit-overflow-scrolling: touch;
        }

        /* Filter System Styles */
        .filter-container {
            background: white;
            padding: 20px;
            border-radius: 10px;
            margin-bottom: 30px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.05);
        }

        .filter-title {
            font-size: 1.2em;
            color: #333;
            margin-bottom: 15px;
        }

        .filter-groups {
            display: flex;
            flex-wrap: wrap;
            gap: 20px;
            margin-bottom: 15px;
        }

        .filter-group {
            flex: 1;
            min-width: 200px;
        }

        .filter-group-title {
            font-size: 0.9em;
            color: #666;
            margin-bottom: 10px;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .tag-container {
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
        }

        .tag {
            display: inline-flex;
            align-items: center;
            padding: 6px 12px;
            background: #f5f5f5;
            border: 1px solid #eee;
            border-radius: 20px;
            cursor: pointer;
            transition: all 0.2s ease;
            font-size: 0.9em;
            color: #555;
        }

        .tag:hover {
            background: #eee;
            transform: translateY(-1px);
        }

        .tag.active {
            background: #4a4a4a;
            color: white;
            border-color: #4a4a4a;
        }

        .active-filters {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            margin-top: 15px;
            padding-top: 15px;
            border-top: 1px solid #eee;
        }

        .active-filter {
            display: inline-flex;
            align-items: center;
            padding: 5px 10px;
            background: #4a4a4a;
            color: white;
            border-radius: 15px;
            font-size: 0.85em;
        }

        .active-filter .remove {
            margin-left: 8px;
            cursor: pointer;
            opacity: 0.8;
            transition: opacity 0.2s;
        }

        .active-filter .remove:hover {
            opacity: 1;
        }

        .clear-filters {
            color: #666;
            text-decoration: underline;
            cursor: pointer;
            font-size: 0.9em;
            margin-left: auto;
        }

        .clear-filters:hover {
            color: #333;
        }

        /* Update existing gallery items to work with filtering */
        .gallery-item {
            transition: all 0.3s ease;
        }

        .gallery-item.hidden {
            display: none;
        }

        @media screen and (max-width: 768px) {
            .filter-groups {
                flex-direction: column;
                gap: 15px;
            }

            .filter-group {
                width: 100%;
            }
        }

        /* Fix for hepatic/portal/renal sub-modals */
        #hepaticMildModal .modal-content,
        #hepaticSevereModal .modal-content,
        #portalMildModal .modal-content,
        #portalSevereModal .modal-content,
        #renalMildModal .modal-content,
        #renalSevereModal .modal-content {
            position: relative;
            margin: 40px auto;
        }

        /* Modal breadcrumb styles */
        .modal-breadcrumb {
            margin-bottom: 15px;
            font-size: 0.9em;
            color: #666;
        }

        .modal-breadcrumb span {
            cursor: pointer;
        }

        .modal-breadcrumb span:hover {
            text-decoration: underline;
        }

        .modal-breadcrumb .separator {
            margin: 0 5px;
            cursor: default;
        }

        .back-button {
            display: inline-block;
            margin-bottom: 15px;
            padding: 5px 10px;
            background: #f5f5f5;
            border-radius: 5px;
            cursor: pointer;
            font-size: 0.9em;
            transition: all 0.2s ease;
        }

        .back-button:hover {
            background: #eee;
        }

        /* Severity tags */
        .severity-tag {
            position: absolute;
            top: 10px;
            right: 10px;
            padding: 4px 8px;
            border-radius: 10px;
            font-size: 0.8em;
            font-weight: 500;
            z-index: 1;
        }

        .severity-tag.normal {
            background: #e3f2fd;
            color: #1976d2;
        }

        .severity-tag.mild {
            background: #fff3e0;
            color: #e65100;
        }

        .severity-tag.severe {
            background: #ffebee;
            color: #c62828;
        }
    </style>
</head>
<body class="is-preload">
    <div id="wrapper">
        <!-- Header (hamburger menu) -->
        <header id="header">
            <div class="inner">
                <!-- Logo -->
                <a href="index.html" class="logo">
                    <span class="symbol"><img src="images/vexus-ai-logo.png" alt="" /></span>
                    <span class="title">VExUS ATLAS</span>
                </a>
                
                <nav>
                    <ul>
                        <li><a href="#menu">Menu</a></li>
                    </ul>
                </nav>
            </div>
        </header>

        <!-- Sidebar Navigation -->
        <nav id="menu">
            <div class="inner">
                <div class="logo-container">
                    <img src="images/vexus-ai-logo.png" alt="VExUS ATLAS Logo" class="sidebar-logo">
                </div>
                <h2>Menu</h2>
                <ul>
                    <li><a href="index.html">Home</a></li>
                    <li><a href="calculator.html">AI Image Recognition</a></li>
                    <li><a href="acquisition.html">Image Acquisition Guide</a></li>
                    <li><a href="education.html">Education</a></li>
                    <li><a href="Publications.html">Publications</a></li>
                    <li><a href="literature_review.html">Literature Review</a></li>
                    <li><a href="about.html">About VExUS ATLAS</a></li>
                    <li><a href="our_team.html">Our Team</a></li>
                    <li><a href="image_gallery.html">Image Gallery</a></li>
                    <li><a href="contact.html">Contact</a></li>
                </ul>
            </div>
        </nav>

        <!-- Main Content -->
        <div id="main">
            <div class="inner">
                <div class="container">
                    <!-- Logos -->
                    <div class="logo-container">
                        <img src="images/vexus-ai-logo.png" alt="VExUS ATLAS Logo" class="logo">
                        <img src="images/Denver.POCUS.png" alt="Denver POCUS Logo" class="logo">
                    </div>
                    <!-- Title -->
                    <div class="title-container">
                        <h1>VExUS Image Gallery</h1>
                        <p>A collection of VExUS ultrasound images showcasing various grades and findings.</p>
                    </div>

                    <!-- Filter System -->
                    <div class="filter-container">
                        <h3 class="filter-title">Filter Images</h3>
                        <div class="filter-groups">
                            <div class="filter-group">
                                <div class="filter-group-title">Quality</div>
                                <div class="tag-container" data-filter-group="quality">
                                    <div class="tag" data-tag="high">High Quality</div>
                                    <div class="tag" data-tag="medium">Medium Quality</div>
                                    <div class="tag" data-tag="low">Low Quality</div>
                                </div>
                            </div>
                            <div class="filter-group">
                                <div class="filter-group-title">Vein Type</div>
                                <div class="tag-container" data-filter-group="vein">
                                    <div class="tag" data-tag="ivc">IVC</div>
                                    <div class="tag" data-tag="hepatic">Hepatic</div>
                                    <div class="tag" data-tag="portal">Portal</div>
                                    <div class="tag" data-tag="renal">Renal</div>
                                </div>
                            </div>
                            <div class="filter-group">
                                <div class="filter-group-title">Waveform</div>
                                <div class="tag-container" data-filter-group="waveform">
                                    <div class="tag" data-tag="normal">Normal</div>
                                    <div class="tag" data-tag="mild">Mild</div>
                                    <div class="tag" data-tag="severe">Severe</div>
                                </div>
                            </div>
                        </div>
                        <div class="active-filters">
                            <span class="clear-filters">Clear all filters</span>
                        </div>
                    </div>

                    <!-- Gallery Grid -->
                    <div class="gallery-grid">
                        <!-- IVC Tile -->
                        <div class="gallery-item" onclick="openModal('ivcModal')" 
                             data-quality="high" data-vein="ivc" data-waveform="normal">
                            <img src="images/IVC_icon.jpeg" alt="IVC Thumbnail">
                            <div class="gallery-item-content">
                                <h3>IVC</h3>
                                <p class="caption">Tap to view details</p>
                                <div class="gallery-item-tags">
                                    <span class="gallery-tag quality">Quality</span>
                                    <span class="gallery-tag vein">IVC</span>
                                    <span class="gallery-tag waveform">All Types</span>
                                </div>
                            </div>
                        </div>
                        <!-- Hepatic Vein Tile -->
                        <div class="gallery-item" onclick="openModal('hepaticModal')"
                             data-quality="high" data-vein="hepatic" data-waveform="normal,mild,severe">
                            <img src="images/hepatic_icon.jpeg" alt="Hepatic Vein Thumbnail">
                            <div class="gallery-item-content">
                                <h3>Hepatic Vein</h3>
                                <p class="caption">Tap to view Mild/Normal/Severe</p>
                                <div class="gallery-item-tags">
                                    <span class="gallery-tag quality">Quality</span>
                                    <span class="gallery-tag vein">Hepatic</span>
                                    <span class="gallery-tag waveform">All Types</span>
                                </div>
                            </div>
                        </div>
                        <!-- Portal Vein Tile -->
                        <div class="gallery-item" onclick="openModal('portalModal')"
                             data-quality="high" data-vein="portal" data-waveform="normal,mild,severe">
                            <img src="images/portal_icon.png" alt="Portal Vein Thumbnail">
                            <div class="gallery-item-content">
                                <h3>Portal Vein</h3>
                                <p class="caption">Tap to view Mild/Normal/Severe</p>
                                <div class="gallery-item-tags">
                                    <span class="gallery-tag quality">Quality</span>
                                    <span class="gallery-tag vein">Portal</span>
                                    <span class="gallery-tag waveform">All Types</span>
                                </div>
                            </div>
                        </div>
                        <!-- Renal Vein Tile -->
                        <div class="gallery-item" onclick="openModal('renalModal')"
                             data-quality="high" data-vein="renal" data-waveform="normal,mild,severe">
                            <img src="images/renal_icon.png" alt="Renal Vein Thumbnail">
                            <div class="gallery-item-content">
                                <h3>Renal Vein</h3>
                                <p class="caption">Tap to view Mild/Normal/Severe</p>
                                <div class="gallery-item-tags">
                                    <span class="gallery-tag quality">Quality</span>
                                    <span class="gallery-tag vein">Renal</span>
                                    <span class="gallery-tag waveform">All Types</span>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Gallery Submission Section -->
                    <div class="container" style="margin-top: 40px;">
                        <h2>Want Your VExUS Image Featured in the Gallery?</h2>
                        <p class="thank-you">Share your high-quality VExUS ultrasound images with the community. Selected images will be featured in our gallery to help educate others.</p>

                        <div class="form-container">
                            <form id="gallerySubmissionForm">
                                <div class="upload-area" id="galleryUploadArea">
                                    <i class="fas fa-cloud-upload-alt upload-icon"></i>
                                    <p class="upload-text">Click or drag and drop your VExUS image here</p>
                                    <input type="file" id="galleryImageInput" class="file-input" accept="image/*" />
                                </div>
                                <div class="image-preview-container" style="display: none;">
                                    <img id="galleryImagePreview" class="image-preview" alt="Image preview" />
                                    <div class="image-preview-controls">
                                        <span class="image-preview-delete" onclick="resetGalleryImageUpload()">×</span>
                                    </div>
                                </div>

                                <label for="gallery_email">Email:</label>
                                <input type="email" id="gallery_email" name="email" required />

                                <label for="gallery_title">Title:</label>
                                <input type="text" id="gallery_title" name="title" required />

                                <label for="gallery_institution">Institution:</label>
                                <input type="text" id="gallery_institution" name="institution" required />

                                <label for="gallery_description">Image Description:</label>
                                <textarea id="gallery_description" name="description" rows="6" required placeholder="Please provide details about the image, including the VExUS grade, clinical context, and any interesting findings."></textarea>

                                <div style="text-align: center; margin-top: 2em;">
                                    <button type="submit">Submit for VExUS ATLAS</button>
                                </div>
                            </form>
                            <div class="success-message">Thank you! Your image has been submitted for review.</div>
                            <div class="error-message">Sorry, there was an error submitting your image. Please try again.</div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- IVC Modal -->
        <div id="ivcModal" class="modal">
            <span class="close" onclick="closeModal('ivcModal')">&times;</span>
            <div class="modal-content">
                <div class="modal-header">
                    <h2 class="modal-title">IVC Ultrasound</h2>
                </div>
                <div class="slideshow-content ivcSlides">
                    <img src="images/IVC_icon.jpeg" alt="IVC Example Image">
                </div>
                <span class="prev" onclick="plusSlides(-1, 'ivcSlides')">&#10094;</span>
                <span class="next" onclick="plusSlides(1, 'ivcSlides')">&#10095;</span>
            </div>
        </div>

        <!-- HEPATIC Vein Modal -->
        <div id="hepaticModal" class="modal">
            <span class="close" onclick="closeModal('hepaticModal')">&times;</span>
            <div class="modal-content">
                <div class="modal-breadcrumb">
                    <span onclick="openModal('hepaticModal')">Hepatic Vein</span>
                </div>
                <div class="modal-header">
                    <h2 class="modal-title">Hepatic Vein Ultrasound</h2>
                </div>
                <div class="modal-filters">
                    <div class="filter-group">
                        <div class="filter-group-title">Filter by Severity</div>
                        <div class="tag-container" data-filter-group="severity">
                            <div class="tag" data-tag="normal">Normal</div>
                            <div class="tag" data-tag="mild">Mild</div>
                            <div class="tag" data-tag="severe">Severe</div>
                        </div>
                    </div>
                </div>
                <div class="sub-tiles">
                    <div class="sub-tile" data-target-modal="hepaticNormalModal" data-severity="normal">
                        <span class="severity-tag normal">Normal</span>
                        <img src="images/image_gallery/Hepatic/Normal/01.02.4.HV.NL.png" alt="Hepatic Normal">
                        <p>Normal Hepatic Flow</p>
                    </div>
                    <div class="sub-tile" data-target-modal="hepaticMildModal" data-severity="mild">
                        <span class="severity-tag mild">Mild</span>
                        <img src="images/image_gallery/Hepatic/Mild/02.0.2.HV.MD.png" alt="Hepatic Mild">
                        <p>Mild Abnormality</p>
                    </div>
                    <div class="sub-tile" data-target-modal="hepaticSevereModal" data-severity="severe">
                        <span class="severity-tag severe">Severe</span>
                        <img src="images/image_gallery/Hepatic/Severe/18.03.01.HV.SR.png" alt="Hepatic Severe">
                        <p>Severe Abnormality</p>
                    </div>
                </div>
            </div>
        </div>

        <!-- HEPATIC Sub-modals with slideshow images -->
        <div id="hepaticNormalModal" class="modal">
            <span class="close" onclick="closeModal('hepaticNormalModal')">&times;</span>
            <div class="modal-content">
                <div class="modal-breadcrumb">
                    <span onclick="openModal('hepaticModal')">Hepatic Vein</span>
                    <span class="separator">/</span>
                    <span>Normal</span>
                </div>
                <div class="back-button" onclick="openModal('hepaticModal')">
                    <i class="fas fa-arrow-left"></i> Back to Hepatic Vein
                </div>
                <div class="slideshow-content hepaticNormalSlides">
                    <img src="images/image_gallery/Hepatic/Normal/01.02.4.HV.NL.png" alt="Hepatic Normal Image" />
                    <img src="images/image_gallery/Hepatic/Normal/05.02.02.HV.NL.png" alt="Hepatic Normal Image 2" />
                </div>
                <span class="prev" onclick="plusSlides(-1, 'hepaticNormalSlides')">&#10094;</span>
                <span class="next" onclick="plusSlides(1, 'hepaticNormalSlides')">&#10095;</span>
            </div>
        </div>

        <div id="hepaticMildModal" class="modal">
            <span class="close" onclick="closeModal('hepaticMildModal')">&times;</span>
            <div class="modal-content">
                <div class="modal-breadcrumb">
                    <span onclick="openModal('hepaticModal')">Hepatic Vein</span>
                    <span class="separator">/</span>
                    <span>Mild</span>
                </div>
                <div class="back-button" onclick="openModal('hepaticModal')">
                    <i class="fas fa-arrow-left"></i> Back to Hepatic Vein
                </div>
                <div class="slideshow-content hepaticMildSlides">
                    <img src="images/image_gallery/Hepatic/Mild/02.0.2.HV.MD.png" alt="Hepatic Mild Image" />
                    <img src="images/image_gallery/Hepatic/Mild/06.03.01.HV.MD.png" alt="Hepatic Mild Image 2" />
                </div>
                <span class="prev" onclick="plusSlides(-1, 'hepaticMildSlides')">&#10094;</span>
                <span class="next" onclick="plusSlides(1, 'hepaticMildSlides')">&#10095;</span>
            </div>
        </div>

        <div id="hepaticSevereModal" class="modal">
            <span class="close" onclick="closeModal('hepaticSevereModal')">&times;</span>
            <div class="modal-content">
                <div class="modal-breadcrumb">
                    <span onclick="openModal('portalModal')">Portal Vein</span>
                    <span class="separator">/</span>
                    <span>Severe</span>
                </div>
                <div class="back-button" onclick="openModal('portalModal')">
                    <i class="fas fa-arrow-left"></i> Back to Portal Vein
                </div>
                <div class="slideshow-content portalSevereSlides">
                    <img src="images/image_gallery/Portal_Vein/Severe/09.01.01.PV.SR.png" alt="Portal Severe Image" />
                </div>
                <span class="prev" onclick="plusSlides(-1, 'portalSevereSlides')">&#10094;</span>
                <span class="next" onclick="plusSlides(1, 'portalSevereSlides')">&#10095;</span>
            </div>
        </div>

        <!-- RENAL Vein Modal -->
        <div id="renalModal" class="modal">
            <span class="close" onclick="closeModal('renalModal')">&times;</span>
            <div class="modal-content">
                <div class="modal-breadcrumb">
                    <span onclick="openModal('renalModal')">Renal Vein</span>
                </div>
                <div class="modal-header">
                    <h2 class="modal-title">Renal Vein Ultrasound</h2>
                </div>
                <div class="modal-filters">
                    <div class="filter-group">
                        <div class="filter-group-title">Filter by Severity</div>
                        <div class="tag-container" data-filter-group="severity">
                            <div class="tag" data-tag="normal">Normal</div>
                            <div class="tag" data-tag="mild">Mild</div>
                            <div class="tag" data-tag="severe">Severe</div>
                        </div>
                    </div>
                </div>
                <div class="sub-tiles">
                    <div class="sub-tile" data-target-modal="renalNormalModal" data-severity="normal">
                        <span class="severity-tag normal">Normal</span>
                        <img src="images/image_gallery/Renal/Normal/normal_renal.png" alt="Renal Normal">
                        <p>Normal Renal Flow</p>
                    </div>
                    <div class="sub-tile" data-target-modal="renalMildModal" data-severity="mild">
                        <span class="severity-tag mild">Mild</span>
                        <img src="images/image_gallery/Renal/Mild/mild_renal.png" alt="Renal Mild">
                        <p>Mild Abnormality</p>
                    </div>
                    <div class="sub-tile" data-target-modal="renalSevereModal" data-severity="severe">
                        <span class="severity-tag severe">Severe</span>
                        <img src="images/image_gallery/Renal/Severe/severe_renal.png" alt="Renal Severe">
                        <p>Severe Abnormality</p>
                    </div>
                </div>
            </div>
        </div>

        <!-- RENAL Sub-modals -->
        <div id="renalNormalModal" class="modal">
            <span class="close" onclick="closeModal('renalNormalModal')">&times;</span>
            <div class="modal-content">
                <div class="modal-breadcrumb">
                    <span onclick="openModal('renalModal')">Renal Vein</span>
                    <span class="separator">/</span>
                    <span>Normal</span>
                </div>
                <div class="back-button" onclick="openModal('renalModal')">
                    <i class="fas fa-arrow-left"></i> Back to Renal Vein
                </div>
                <div class="slideshow-content renalNormalSlides">
                    <img src="images/image_gallery/Renal/Normal/normal_renal.png" alt="Renal Normal Image" />
                </div>
                <span class="prev" onclick="plusSlides(-1, 'renalNormalSlides')">&#10094;</span>
                <span class="next" onclick="plusSlides(1, 'renalNormalSlides')">&#10095;</span>
            </div>
        </div>

        <div id="renalMildModal" class="modal">
            <span class="close" onclick="closeModal('renalMildModal')">&times;</span>
            <div class="modal-content">
                <div class="modal-breadcrumb">
                    <span onclick="openModal('renalModal')">Renal Vein</span>
                    <span class="separator">/</span>
                    <span>Mild</span>
                </div>
                <div class="back-button" onclick="openModal('renalModal')">
                    <i class="fas fa-arrow-left"></i> Back to Renal Vein
                </div>
                <div class="slideshow-content renalMildSlides">
                    <img src="images/image_gallery/Renal/Mild/mild_renal.png" alt="Renal Mild Image" />
                </div>
                <span class="prev" onclick="plusSlides(-1, 'renalMildSlides')">&#10094;</span>
                <span class="next" onclick="plusSlides(1, 'renalMildSlides')">&#10095;</span>
            </div>
        </div>

        <div id="renalSevereModal" class="modal">
            <span class="close" onclick="closeModal('renalSevereModal')">&times;</span>
            <div class="modal-content">
                <div class="modal-breadcrumb">
                    <span onclick="openModal('renalModal')">Renal Vein</span>
                    <span class="separator">/</span>
                    <span>Severe</span>
                </div>
                <div class="back-button" onclick="openModal('renalModal')">
                    <i class="fas fa-arrow-left"></i> Back to Renal Vein
                </div>
                <div class="slideshow-content renalSevereSlides">
                    <img src="images/image_gallery/Renal/Severe/severe_renal.png" alt="Renal Severe Image" />
                </div>
                <span class="prev" onclick="plusSlides(-1, 'renalSevereSlides')">&#10094;</span>
                <span class="next" onclick="plusSlides(1, 'renalSevereSlides')">&#10095;</span>
            </div>
        </div>

        <!-- PORTAL Vein Modal -->
        <div id="portalModal" class="modal">
            <span class="close" onclick="closeModal('portalModal')">&times;</span>
            <div class="modal-content">
                <div class="modal-breadcrumb">
                    <span onclick="openModal('portalModal')">Portal Vein</span>
                </div>
                <div class="modal-header">
                    <h2 class="modal-title">Portal Vein Ultrasound</h2>
                </div>
                <div class="modal-filters">
                    <div class="filter-group">
                        <div class="filter-group-title">Filter by Severity</div>
                        <div class="tag-container" data-filter-group="severity">
                            <div class="tag" data-tag="normal">Normal</div>
                            <div class="tag" data-tag="mild">Mild</div>
                            <div class="tag" data-tag="severe">Severe</div>
                        </div>
                    </div>
                </div>
                <div class="sub-tiles">
                    <div class="sub-tile" data-target-modal="portalNormalModal" data-severity="normal">
                        <span class="severity-tag normal">Normal</span>
                        <img src="images/image_gallery/Portal_Vein/Normal/01.1.2.PV.NL.png" alt="Portal Normal">
                        <p>Normal Portal Flow</p>
                    </div>
                    <div class="sub-tile" data-target-modal="portalMildModal" data-severity="mild">
                        <span class="severity-tag mild">Mild</span>
                        <img src="images/image_gallery/Portal_Vein/Mild/01.0.1.PV.MD.png" alt="Portal Mild">
                        <p>Mild Abnormality</p>
                    </div>
                    <div class="sub-tile" data-target-modal="portalSevereModal" data-severity="severe">
                        <span class="severity-tag severe">Severe</span>
                        <img src="images/image_gallery/Portal_Vein/Severe/09.01.01.PV.SR.png" alt="Portal Severe">
                        <p>Severe Abnormality</p>
                    </div>
                </div>
            </div>
        </div>

        <!-- PORTAL Sub-modals -->
        <div id="portalNormalModal" class="modal">
            <span class="close" onclick="closeModal('portalNormalModal')">&times;</span>
            <div class="modal-content">
                <div class="modal-breadcrumb">
                    <span onclick="openModal('portalModal')">Portal Vein</span>
                    <span class="separator">/</span>
                    <span>Normal</span>
                </div>
                <div class="back-button" onclick="openModal('portalModal')">
                    <i class="fas fa-arrow-left"></i> Back to Portal Vein
                </div>
                <div class="slideshow-content portalNormalSlides">
                    <img src="images/image_gallery/Portal_Vein/Normal/01.1.2.PV.NL.png" alt="Portal Normal Image" />
                </div>
                <span class="prev" onclick="plusSlides(-1, 'portalNormalSlides')">&#10094;</span>
                <span class="next" onclick="plusSlides(1, 'portalNormalSlides')">&#10095;</span>
            </div>
        </div>

        <div id="portalMildModal" class="modal">
            <span class="close" onclick="closeModal('portalMildModal')">&times;</span>
            <div class="modal-content">
                <div class="modal-breadcrumb">
                    <span onclick="openModal('portalModal')">Portal Vein</span>
                    <span class="separator">/</span>
                    <span>Mild</span>
                </div>
                <div class="back-button" onclick="openModal('portalModal')">
                    <i class="fas fa-arrow-left"></i> Back to Portal Vein
                </div>
                <div class="slideshow-content portalMildSlides">
                    <img src="images/image_gallery/Portal_Vein/Mild/01.0.1.PV.MD.png" alt="Portal Mild Image" />
                </div>
                <span class="prev" onclick="plusSlides(-1, 'portalMildSlides')">&#10094;</span>
                <span class="next" onclick="plusSlides(1, 'portalMildSlides')">&#10095;</span>
            </div>
        </div>

        <div id="portalSevereModal" class="modal">
            <span class="close" onclick="closeModal('portalSevereModal')">&times;</span>
            <div class="modal-content">
                <div class="modal-breadcrumb">
                    <span onclick="openModal('portalModal')">Portal Vein</span>
                    <span class="separator">/</span>
                    <span>Severe</span>
                </div>
                <div class="back-button" onclick="openModal('portalModal')">
                    <i class="fas fa-arrow-left"></i> Back to Portal Vein
                </div>
                <div class="slideshow-content portalSevereSlides">
                    <img src="images/image_gallery/Portal_Vein/Severe/09.01.01.PV.SR.png" alt="Portal Severe Image" />
                </div>
                <span class="prev" onclick="plusSlides(-1, 'portalSevereSlides')">&#10094;</span>
                <span class="next" onclick="plusSlides(1, 'portalSevereSlides')">&#10095;</span>
            </div>
        </div>
    </div>
    
    <!-- Scripts -->
    <script src="html5up-phantom/assets/js/jquery.min.js"></script>
    <script src="html5up-phantom/assets/js/browser.min.js"></script>
    <script src="html5up-phantom/assets/js/breakpoints.min.js"></script>
    <script src="html5up-phantom/assets/js/util.js"></script>
    <script src="html5up-phantom/assets/js/main.js"></script>

    <script>
        // Global variables for modal and slideshow management
        const slideIndex = {};
        let currentModal = null;
        let modalStack = [];
        let isTransitioning = false;

        // Initialize all functionality when DOM is loaded
        document.addEventListener('DOMContentLoaded', function() {
            setupGalleryItems();
            setupSubTiles();
            setupModalControls();
            setupTagFiltering();
            setupGalleryUpload();
            setupModalFilters();
        });

        // Setup gallery item click handlers
        function setupGalleryItems() {
            document.querySelectorAll('.gallery-item').forEach(item => {
                const modalId = item.getAttribute('onclick')?.match(/'([^']+)'/)?.[1];
                if (modalId) {
                    item.removeAttribute('onclick');
                    item.addEventListener('click', () => openModal(modalId));
                }
            });
        }

        // Setup sub-tile click handlers
        function setupSubTiles() {
            document.querySelectorAll('.sub-tile').forEach(tile => {
                const targetModal = tile.dataset.targetModal;
                if (targetModal) {
                    tile.addEventListener('click', (e) => {
                        e.preventDefault();
                        e.stopPropagation();
                        openModal(targetModal, true);
                    });
                }
            });
        }

        // Setup modal controls (close buttons, back buttons, etc.)
        function setupModalControls() {
            // Close buttons
            document.querySelectorAll('.modal .close').forEach(closeBtn => {
                const modalId = closeBtn.closest('.modal').id;
                closeBtn.removeAttribute('onclick');
                closeBtn.addEventListener('click', () => closeModal(modalId));
            });

            // Back buttons
            document.querySelectorAll('.back-button').forEach(button => {
                button.removeAttribute('onclick');
                button.addEventListener('click', (e) => {
                    e.preventDefault();
                    e.stopPropagation();
                    const currentModalElement = button.closest('.modal');
                    if (currentModalElement) {
                        closeModal(currentModalElement.id);
                    }
                });
            });

            // Breadcrumb navigation
            document.querySelectorAll('.modal-breadcrumb span').forEach(span => {
                if (!span.classList.contains('separator')) {
                    const targetModal = span.getAttribute('onclick')?.match(/'([^']+)'/)?.[1];
                    if (targetModal) {
                        span.removeAttribute('onclick');
                        span.addEventListener('click', () => openModal(targetModal));
                    }
                }
            });

            // Slideshow navigation
            document.querySelectorAll('.prev, .next').forEach(navBtn => {
                const direction = navBtn.classList.contains('prev') ? -1 : 1;
                const slidesClass = navBtn.getAttribute('onclick')?.match(/plusSlides\([-\d]+,\s*'([^']+)'/)?.[1];
                if (slidesClass) {
                    navBtn.removeAttribute('onclick');
                    navBtn.addEventListener('click', () => plusSlides(direction, slidesClass));
                }
            });

            // Close modal on outside click
            document.querySelectorAll('.modal').forEach(modal => {
                modal.addEventListener('click', (e) => {
                    if (e.target === modal) {
                        closeModal(modal.id);
                    }
                });
            });

            // Prevent modal content clicks from bubbling
            document.querySelectorAll('.modal-content').forEach(content => {
                content.addEventListener('click', (e) => {
                    e.stopPropagation();
                });
            });

            // Close modal on escape key
            document.addEventListener('keydown', (e) => {
                if (e.key === 'Escape' && currentModal) {
                    closeModal(currentModal);
                }
            });
        }

        // Opens modal by ID
        function openModal(modalId, isSubModal = false) {
            if (isTransitioning) return;
            isTransitioning = true;
            
            const modal = document.getElementById(modalId);
            if (!modal) {
                isTransitioning = false;
                return;
            }
            
            // If opening a sub-modal, add current to stack
            if (isSubModal && currentModal) {
                modalStack.push(currentModal);
                const currentModalElement = document.getElementById(currentModal);
                if (currentModalElement) {
                    currentModalElement.style.display = "none";
                    currentModalElement.classList.remove('show');
                }
            } else {
                // If opening a main modal, clear the stack
                modalStack.forEach(id => {
                    const modalElement = document.getElementById(id);
                    if (modalElement) {
                        modalElement.style.display = "none";
                        modalElement.classList.remove('show');
                    }
                });
                modalStack = [];
                if (currentModal) {
                    const currentModalElement = document.getElementById(currentModal);
                    if (currentModalElement) {
                        currentModalElement.style.display = "none";
                        currentModalElement.classList.remove('show');
                    }
                }
            }
            
            currentModal = modalId;
            
            // Reset scroll position and lock body scroll
            window.scrollTo(0, 0);
            document.body.style.overflow = 'hidden';
            
            // Show modal with transition
            modal.style.display = "block";
            modal.offsetHeight; // Force reflow
            
            requestAnimationFrame(() => {
                modal.classList.add('show');
                
                // Initialize slideshow if present
                initializeSlideshow(modal);
                
                setTimeout(() => {
                    isTransitioning = false;
                }, 300);
            });
        }

        // Initialize slideshow within a modal
        function initializeSlideshow(modal) {
            const container = modal.querySelector('.slideshow-content');
            if (!container) return;

            const imgs = container.getElementsByTagName("img");
            if (!imgs.length) return;

            // Reset all images
            Array.from(imgs).forEach(img => {
                img.style.display = "none";
                img.style.opacity = "0";
            });

            // Show first image
            imgs[0].style.display = "block";
            requestAnimationFrame(() => {
                imgs[0].style.opacity = "1";
            });
            
            slideIndex[container.classList[1]] = 0;
        }

        // Closes modal
        function closeModal(modalId) {
            if (isTransitioning) return;
            isTransitioning = true;
            
            const modal = document.getElementById(modalId);
            if (!modal) {
                isTransitioning = false;
                return;
            }

            modal.classList.remove('show');
            
            // If there's a modal in the stack, show it
            if (modalStack.length > 0) {
                currentModal = modalStack.pop();
                const previousModal = document.getElementById(currentModal);
                if (previousModal) {
                    previousModal.style.display = "block";
                    previousModal.offsetHeight; // Force reflow
                    requestAnimationFrame(() => {
                        previousModal.classList.add('show');
                    });
                }
            } else {
                // No modals in stack, reset everything
                document.body.style.overflow = '';
                currentModal = null;
            }

            // Use setTimeout to match the CSS transition duration
            setTimeout(() => {
                if (modal.style.display === "block") {
                    modal.style.display = "none";
                    
                    // Reset any slideshow images
                    const container = modal.querySelector('.slideshow-content');
                    if (container) {
                        const imgs = container.getElementsByTagName("img");
                        Array.from(imgs).forEach(img => {
                            img.style.opacity = "0";
                            img.style.display = "none";
                        });
                    }
                }
                isTransitioning = false;
            }, 300);
        }

        // Next/prev for slides with smooth transitions
        function plusSlides(n, className) {
            if (isTransitioning) return;
            
            const container = document.getElementsByClassName(className)[0];
            if (!container) return;

            const imgs = container.getElementsByTagName("img");
            if (!imgs.length) return;

            if (!slideIndex[className] && slideIndex[className] !== 0) {
                slideIndex[className] = 0;
            }

            let currentIndex = slideIndex[className];
            isTransitioning = true;
            
            // Fade out current image
            imgs[currentIndex].style.transition = 'opacity 0.3s ease';
            imgs[currentIndex].style.opacity = '0';
            
            setTimeout(() => {
                imgs[currentIndex].style.display = "none";
                imgs[currentIndex].style.transition = '';
                
                currentIndex += n;
                if (currentIndex < 0) {
                    currentIndex = imgs.length - 1;
                } else if (currentIndex >= imgs.length) {
                    currentIndex = 0;
                }
                
                // Show and fade in new image
                imgs[currentIndex].style.display = "block";
                imgs[currentIndex].style.transition = 'opacity 0.3s ease';
                
                requestAnimationFrame(() => {
                    imgs[currentIndex].style.opacity = '1';
                });
                
                slideIndex[className] = currentIndex;
                
                // Reset transition after animation
                setTimeout(() => {
                    imgs[currentIndex].style.transition = '';
                    isTransitioning = false;
                }, 300);
            }, 300);
        }

        // Setup tag filtering system
        function setupTagFiltering() {
            const activeFilters = {
                quality: [],
                vein: [],
                waveform: []
            };

            // Initialize tag click handlers
            document.querySelectorAll('.tag-container[data-filter-group]').forEach(container => {
                const group = container.dataset.filterGroup;
                if (!group) return;
                
                container.querySelectorAll('.tag').forEach(tag => {
                    tag.addEventListener('click', () => {
                        const value = tag.dataset.tag;
                        if (!value) return;
                        
                        if (tag.classList.contains('active')) {
                            // Remove filter
                            tag.classList.remove('active');
                            activeFilters[group] = activeFilters[group].filter(t => t !== value);
                        } else {
                            // Add filter
                            tag.classList.add('active');
                            activeFilters[group].push(value);
                        }
                        
                        updateActiveFiltersUI();
                        updateGalleryItems();
                    });
                });
            });

            // Handle removing active filters
            document.querySelector('.active-filters')?.addEventListener('click', (e) => {
                if (e.target.classList.contains('remove')) {
                    const group = e.target.dataset.group;
                    const tag = e.target.dataset.tag;
                    
                    // Remove from active filters
                    activeFilters[group] = activeFilters[group].filter(t => t !== tag);
                    
                    // Update tag UI
                    document.querySelector(`.tag[data-tag="${tag}"]`)?.classList.remove('active');
                    
                    updateActiveFiltersUI();
                    updateGalleryItems();
                }
            });

            // Clear all filters
            document.querySelector('.clear-filters')?.addEventListener('click', () => {
                Object.keys(activeFilters).forEach(group => {
                    activeFilters[group] = [];
                });
                
                document.querySelectorAll('.tag.active').forEach(tag => {
                    tag.classList.remove('active');
                });
                
                updateActiveFiltersUI();
                updateGalleryItems();
            });

            function updateActiveFiltersUI() {
                const container = document.querySelector('.active-filters');
                if (!container) return;
                
                // Clear existing active filters except the "Clear all" button
                while (container.firstChild && !container.firstChild.classList.contains('clear-filters')) {
                    container.removeChild(container.firstChild);
                }

                // Add new active filter tags
                Object.entries(activeFilters).forEach(([group, tags]) => {
                    tags.forEach(tag => {
                        const filterTag = document.createElement('span');
                        filterTag.className = 'active-filter';
                        filterTag.innerHTML = `${tag} <span class="remove" data-group="${group}" data-tag="${tag}">×</span>`;
                        container.insertBefore(filterTag, container.querySelector('.clear-filters'));
                    });
                });

                // Show/hide clear all button
                const clearAll = container.querySelector('.clear-filters');
                if (clearAll) {
                    const hasActiveFilters = Object.values(activeFilters).some(arr => arr.length > 0);
                    clearAll.style.display = hasActiveFilters ? 'block' : 'none';
                }
            }

            function updateGalleryItems() {
                const items = document.querySelectorAll('.gallery-item');
                
                items.forEach(item => {
                    let visible = true;
                    
                    // Check each filter group
                    Object.entries(activeFilters).forEach(([group, tags]) => {
                        if (tags.length > 0) {
                            const itemTags = item.dataset[group]?.split(',') || [];
                            const hasMatch = tags.some(tag => itemTags.includes(tag));
                            if (!hasMatch) visible = false;
                        }
                    });
                    
                    item.classList.toggle('hidden', !visible);
                });
            }
        }

        // Setup modal filters for subfolders
        function setupModalFilters() {
            document.querySelectorAll('.modal-filters .tag').forEach(tag => {
                tag.addEventListener('click', () => {
                    const group = tag.parentElement.dataset.filterGroup;
                    if (!group) return;
                    
                    const value = tag.dataset.tag;
                    if (!value) return;
                    
                    const isActive = tag.classList.contains('active');
                    
                    // Toggle active state
                    if (isActive) {
                        tag.classList.remove('active');
                    } else {
                        // If it's a single-select filter, deactivate others in the group
                        tag.parentElement.querySelectorAll('.tag').forEach(t => t.classList.remove('active'));
                        tag.classList.add('active');
                    }
                    
                    // Filter sub-tiles
                    filterSubTiles(group, isActive ? null : value);
                });
            });

            function filterSubTiles(group, value) {
                const subTiles = document.querySelectorAll('.sub-tiles .sub-tile');
                subTiles.forEach(tile => {
                    if (!value) {
                        tile.style.display = 'block';
                        return;
                    }
                    
                    const tileValue = tile.dataset[group];
                    tile.style.display = tileValue === value ? 'block' : 'none';
                });
            }
        }

        // Setup gallery image upload functionality
        function setupGalleryUpload() {
            const galleryUploadArea = document.getElementById('galleryUploadArea');
            const galleryImageInput = document.getElementById('galleryImageInput');
            
            if (!galleryUploadArea || !galleryImageInput) return;

            galleryUploadArea.addEventListener('click', () => galleryImageInput.click());
            galleryImageInput.addEventListener('change', handleGalleryImageUpload);

            galleryUploadArea.addEventListener('dragover', (e) => {
                e.preventDefault();
                galleryUploadArea.style.borderColor = '#28a745';
                galleryUploadArea.style.backgroundColor = 'rgba(40, 167, 69, 0.05)';
            });

            galleryUploadArea.addEventListener('dragleave', () => {
                galleryUploadArea.style.borderColor = '#ccc';
                galleryUploadArea.style.backgroundColor = 'transparent';
            });

            galleryUploadArea.addEventListener('drop', (e) => {
                e.preventDefault();
                galleryUploadArea.style.borderColor = '#ccc';
                galleryUploadArea.style.backgroundColor = 'transparent';
                if (e.dataTransfer.files.length) {
                    galleryImageInput.files = e.dataTransfer.files;
                    handleGalleryImageUpload({ target: { files: e.dataTransfer.files } });
                }
            });

            // Handle gallery submission
            document.getElementById('gallerySubmissionForm')?.addEventListener('submit', async (e) => {
                e.preventDefault();
                
                const formData = new FormData();
                const imageFile = document.getElementById('galleryImageInput').files[0];
                
                if (!imageFile) {
                    document.querySelector('#gallerySubmissionForm .error-message').textContent = 'Please upload an image.';
                    document.querySelector('#gallerySubmissionForm .error-message').style.display = 'block';
                    document.querySelector('#gallerySubmissionForm .success-message').style.display = 'none';
                    return;
                }

                formData.append('image', imageFile);
                formData.append('email', document.getElementById('gallery_email').value);
                formData.append('title', document.getElementById('gallery_title').value);
                formData.append('institution', document.getElementById('gallery_institution').value);
                formData.append('description', document.getElementById('gallery_description').value);

                try {
                    const response = await fetch('/api/gallery-submission', {
                        method: 'POST',
                        body: formData
                    });

                    if (response.ok) {
                        document.querySelector('#gallerySubmissionForm .success-message').style.display = 'block';
                        document.querySelector('#gallerySubmissionForm .error-message').style.display = 'none';
                        document.getElementById('gallerySubmissionForm').reset();
                        resetGalleryImageUpload();
                    } else {
                        const errorData = await response.json();
                        throw new Error(errorData.message || 'Failed to submit image');
                    }
                } catch (error) {
                    document.querySelector('#gallerySubmissionForm .error-message').textContent = 
                        error.message || 'Sorry, there was an error submitting your image. Please try again.';
                    document.querySelector('#gallerySubmissionForm .error-message').style.display = 'block';
                    document.querySelector('#gallerySubmissionForm .success-message').style.display = 'none';
                }
            });
        }

        function handleGalleryImageUpload(event) {
            const file = event.target.files[0];
            if (file) {
                const reader = new FileReader();
                reader.onload = function(e) {
                    const preview = document.getElementById('galleryImagePreview');
                    const container = document.querySelector('#gallerySubmissionForm .image-preview-container');
                    preview.src = e.target.result;
                    preview.style.display = 'block';
                    container.style.display = 'block';
                    document.querySelector('#galleryUploadArea').style.borderColor = '#28a745';
                }
                reader.readAsDataURL(file);
            }
        }

        function resetGalleryImageUpload() {
            document.getElementById('galleryImageInput').value = '';
            document.getElementById('galleryImagePreview').style.display = 'none';
            document.querySelector('#gallerySubmissionForm .image-preview-container').style.display = 'none';
            document.querySelector('#galleryUploadArea').style.borderColor = '#ccc';
        }
    </script>
</body>
</html>
