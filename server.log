Server running on port 3002
Configuration: {
  "projectId": "plucky-weaver-450819-k7",
  "projectNumber": "456295042668",
  "location": "us-central1",
  "endpointIds": {
    "hepatic": "8159951878260523008",
    "portal": "2970410926785691648",
    "renal": "1148704877514326016"
  },
  "onDemandEndpointService": "https://endpoints-on-demand-456295042668.us-central1.run.app",
  "lastUpdated": "2025-03-08T09:46:06.955Z",
  "developer": "Gabesiegel",
  "bucketName": "vexus-ai-images-plucky-weaver-450819-k7-20250223131511"
}
[2025-03-08T09:46:28.389Z] Requesting: /api/predict
Received prediction request
Prediction request for hepatic vein
Processing image from instances array
Preparing image for prediction, type: image/jpeg
Image content appears to be already in base64 format without prefix
Image prepared for prediction, mime type: image/jpeg
Calling on-demand service for prediction
[DIAGNOSTIC] REQUEST - hepatic
[DIAGNOSTIC] Data: {
  "veinType": "hepatic",
  "imageType": "image/jpeg",
  "hasInstances": true,
  "instanceCount": 1,
  "parameters": {
    "confidenceThreshold": 0,
    "maxPredictions": 5
  }
}
Getting credentials from Secret Manager: projects/plucky-weaver-450819-k7/secrets/KEY/versions/latest
[DIAGNOSTIC] ONDEMAND_REQUEST - hepatic
[DIAGNOSTIC] Data: {
  "instances": [
    {
      "content": "[BASE64 DATA - 748 chars]"
    }
  ],
  "parameters": {
    "confidenceThreshold": 0,
    "maxPredictions": 5
  },
  "metadata": {
    "veinType": "hepatic",
    "imageType": "image/jpeg",
    "timestamp": 1741427189532
  }
}
Making API call to https://endpoints-on-demand-456295042668.us-central1.run.app (attempt 1/3)
API call attempt 1 failed: API call failed with status 404: <!doctype html>
<html lang=en>
<title>404 Not Found</title>
<h1>Not Found</h1>
<p>The requested URL was not found on the server. If you entered the URL manually please check your spelling and try again.</p>

Waiting 2000ms before retry...
Making API call to https://endpoints-on-demand-456295042668.us-central1.run.app (attempt 2/3)
API call attempt 2 failed: API call failed with status 404: <!doctype html>
<html lang=en>
<title>404 Not Found</title>
<h1>Not Found</h1>
<p>The requested URL was not found on the server. If you entered the URL manually please check your spelling and try again.</p>

Waiting 4000ms before retry...
Making API call to https://endpoints-on-demand-456295042668.us-central1.run.app (attempt 3/3)
API call attempt 3 failed: API call failed with status 404: <!doctype html>
<html lang=en>
<title>404 Not Found</title>
<h1>Not Found</h1>
<p>The requested URL was not found on the server. If you entered the URL manually please check your spelling and try again.</p>

On-demand service error: Error: API call failed with status 404: <!doctype html>
<html lang=en>
<title>404 Not Found</title>
<h1>Not Found</h1>
<p>The requested URL was not found on the server. If you entered the URL manually please check your spelling and try again.</p>

    at makeApiCallWithRetry (file:///Users/gabe/VEXUS/server.js:1169:23)
    at process.processTicksAndRejections (node:internal/process/task_queues:95:5)
    at async file:///Users/gabe/VEXUS/server.js:521:28
[DIAGNOSTIC] ONDEMAND_ERROR - hepatic
[DIAGNOSTIC] Error: API call failed with status 404: <!doctype html>
<html lang=en>
<title>404 Not Found</title>
<h1>Not Found</h1>
<p>The requested URL was not found on the server. If you entered the URL manually please check your spelling and try again.</p>

[DIAGNOSTIC] Stack: Error: API call failed with status 404: <!doctype html>
<html lang=en>
<title>404 Not Found</title>
<h1>Not Found</h1>
<p>The requested URL was not found on the server. If you entered the URL manually please check your spelling and try again.</p>

    at makeApiCallWithRetry (file:///Users/gabe/VEXUS/server.js:1169:23)
    at process.processTicksAndRejections (node:internal/process/task_queues:95:5)
    at async file:///Users/gabe/VEXUS/server.js:521:28
Falling back to direct Vertex AI call
Getting credentials from Secret Manager...
Getting credentials from Secret Manager: projects/plucky-weaver-450819-k7/secrets/KEY/versions/latest
Initializing Vertex AI client with Secret Manager credentials
Using Vertex AI API endpoint: us-central1-aiplatform.googleapis.com
Configured endpoints - Hepatic: 8159951878260523008, Portal: 2970410926785691648, Renal: 1148704877514326016
Sending direct prediction request to endpoint: projects/456295042668/locations/us-central1/endpoints/8159951878260523008
[DIAGNOSTIC] DIRECT_REQUEST - hepatic
[DIAGNOSTIC] Data: {
  "endpoint": "projects/456295042668/locations/us-central1/endpoints/8159951878260523008",
  "instances": [
    {
      "content": "[BASE64 DATA - 748 chars]"
    }
  ],
  "parameters": {
    "confidenceThreshold": 0,
    "maxPredictions": 5
  }
}
Direct Vertex AI call failed: Error: 3 INVALID_ARGUMENT: 
    at callErrorFromStatus (/Users/gabe/VEXUS/node_modules/@grpc/grpc-js/build/src/call.js:31:19)
    at Object.onReceiveStatus (/Users/gabe/VEXUS/node_modules/@grpc/grpc-js/build/src/client.js:192:76)
    at Object.onReceiveStatus (/Users/gabe/VEXUS/node_modules/@grpc/grpc-js/build/src/client-interceptors.js:360:141)
    at Object.onReceiveStatus (/Users/gabe/VEXUS/node_modules/@grpc/grpc-js/build/src/client-interceptors.js:323:181)
    at /Users/gabe/VEXUS/node_modules/@grpc/grpc-js/build/src/resolving-call.js:94:78
    at process.processTicksAndRejections (node:internal/process/task_queues:77:11)
for call at
    at ServiceClientImpl.makeUnaryRequest (/Users/gabe/VEXUS/node_modules/@grpc/grpc-js/build/src/client.js:160:32)
    at ServiceClientImpl.<anonymous> (/Users/gabe/VEXUS/node_modules/@grpc/grpc-js/build/src/make-client.js:105:19)
    at /Users/gabe/VEXUS/node_modules/@google-cloud/aiplatform/build/src/v1/prediction_service_client.js:219:29
    at /Users/gabe/VEXUS/node_modules/google-gax/build/src/normalCalls/timeout.js:44:16
    at OngoingCallPromise.call (/Users/gabe/VEXUS/node_modules/google-gax/build/src/call.js:67:27)
    at NormalApiCaller.call (/Users/gabe/VEXUS/node_modules/google-gax/build/src/normalCalls/normalApiCaller.js:34:19)
    at /Users/gabe/VEXUS/node_modules/google-gax/build/src/createApiCall.js:84:30 {
  code: 3,
  details: '',
  metadata: Metadata {
    internalRepr: Map(3) {
      'endpoint-load-metrics-bin' => [Array],
      'grpc-server-stats-bin' => [Array],
      'pc-high-bwd-bin' => [Array]
    },
    options: {}
  }
}
[DIAGNOSTIC] DIRECT_ERROR - hepatic
[DIAGNOSTIC] Error: 3 INVALID_ARGUMENT: 
[DIAGNOSTIC] Stack: Error: 3 INVALID_ARGUMENT: 
    at callErrorFromStatus (/Users/gabe/VEXUS/node_modules/@grpc/grpc-js/build/src/call.js:31:19)
    at Object.onReceiveStatus (/Users/gabe/VEXUS/node_modules/@grpc/grpc-js/build/src/client.js:192:76)
    at Object.onReceiveStatus (/Users/gabe/VEXUS/node_modules/@grpc/grpc-js/build/src/client-interceptors.js:360:141)
    at Object.onReceiveStatus (/Users/gabe/VEXUS/node_modules/@grpc/grpc-js/build/src/client-interceptors.js:323:181)
    at /Users/gabe/VEXUS/node_modules/@grpc/grpc-js/build/src/resolving-call.js:94:78
    at process.processTicksAndRejections (node:internal/process/task_queues:77:11)
for call at
    at ServiceClientImpl.makeUnaryRequest (/Users/gabe/VEXUS/node_modules/@grpc/grpc-js/build/src/client.js:160:32)
    at ServiceClientImpl.<anonymous> (/Users/gabe/VEXUS/node_modules/@grpc/grpc-js/build/src/make-client.js:105:19)
    at /Users/gabe/VEXUS/node_modules/@google-cloud/aiplatform/build/src/v1/prediction_service_client.js:219:29
    at /Users/gabe/VEXUS/node_modules/google-gax/build/src/normalCalls/timeout.js:44:16
    at OngoingCallPromise.call (/Users/gabe/VEXUS/node_modules/google-gax/build/src/call.js:67:27)
    at NormalApiCaller.call (/Users/gabe/VEXUS/node_modules/google-gax/build/src/normalCalls/normalApiCaller.js:34:19)
    at /Users/gabe/VEXUS/node_modules/google-gax/build/src/createApiCall.js:84:30
Scheduling shutdown for hepatic endpoint in 5 minutes
Returning prediction error after both services failed
Prediction request completed in 9453ms
[2025-03-08T09:46:37.851Z] Requesting: /api/predict
Received prediction request
Prediction request for portal vein
Processing image from instances array
Preparing image for prediction, type: image/jpeg
Image content appears to be already in base64 format without prefix
Image prepared for prediction, mime type: image/jpeg
Calling on-demand service for prediction
[DIAGNOSTIC] REQUEST - portal
[DIAGNOSTIC] Data: {
  "veinType": "portal",
  "imageType": "image/jpeg",
  "hasInstances": true,
  "instanceCount": 1,
  "parameters": {
    "confidenceThreshold": 0,
    "maxPredictions": 5
  }
}
Getting credentials from Secret Manager: projects/plucky-weaver-450819-k7/secrets/KEY/versions/latest
[DIAGNOSTIC] ONDEMAND_REQUEST - portal
[DIAGNOSTIC] Data: {
  "instances": [
    {
      "content": "[BASE64 DATA - 748 chars]"
    }
  ],
  "parameters": {
    "confidenceThreshold": 0,
    "maxPredictions": 5
  },
  "metadata": {
    "veinType": "portal",
    "imageType": "image/jpeg",
    "timestamp": 1741427198017
  }
}
Making API call to https://endpoints-on-demand-456295042668.us-central1.run.app (attempt 1/3)
API call attempt 1 failed: API call failed with status 404: <!doctype html>
<html lang=en>
<title>404 Not Found</title>
<h1>Not Found</h1>
<p>The requested URL was not found on the server. If you entered the URL manually please check your spelling and try again.</p>

Waiting 2000ms before retry...
Making API call to https://endpoints-on-demand-456295042668.us-central1.run.app (attempt 2/3)
API call attempt 2 failed: API call failed with status 404: <!doctype html>
<html lang=en>
<title>404 Not Found</title>
<h1>Not Found</h1>
<p>The requested URL was not found on the server. If you entered the URL manually please check your spelling and try again.</p>

Waiting 4000ms before retry...
Making API call to https://endpoints-on-demand-456295042668.us-central1.run.app (attempt 3/3)
API call attempt 3 failed: API call failed with status 404: <!doctype html>
<html lang=en>
<title>404 Not Found</title>
<h1>Not Found</h1>
<p>The requested URL was not found on the server. If you entered the URL manually please check your spelling and try again.</p>

On-demand service error: Error: API call failed with status 404: <!doctype html>
<html lang=en>
<title>404 Not Found</title>
<h1>Not Found</h1>
<p>The requested URL was not found on the server. If you entered the URL manually please check your spelling and try again.</p>

    at makeApiCallWithRetry (file:///Users/gabe/VEXUS/server.js:1169:23)
    at process.processTicksAndRejections (node:internal/process/task_queues:95:5)
    at async file:///Users/gabe/VEXUS/server.js:521:28
[DIAGNOSTIC] ONDEMAND_ERROR - portal
[DIAGNOSTIC] Error: API call failed with status 404: <!doctype html>
<html lang=en>
<title>404 Not Found</title>
<h1>Not Found</h1>
<p>The requested URL was not found on the server. If you entered the URL manually please check your spelling and try again.</p>

[DIAGNOSTIC] Stack: Error: API call failed with status 404: <!doctype html>
<html lang=en>
<title>404 Not Found</title>
<h1>Not Found</h1>
<p>The requested URL was not found on the server. If you entered the URL manually please check your spelling and try again.</p>

    at makeApiCallWithRetry (file:///Users/gabe/VEXUS/server.js:1169:23)
    at process.processTicksAndRejections (node:internal/process/task_queues:95:5)
    at async file:///Users/gabe/VEXUS/server.js:521:28
Falling back to direct Vertex AI call
Sending direct prediction request to endpoint: projects/456295042668/locations/us-central1/endpoints/2970410926785691648
[DIAGNOSTIC] DIRECT_REQUEST - portal
[DIAGNOSTIC] Data: {
  "endpoint": "projects/456295042668/locations/us-central1/endpoints/2970410926785691648",
  "instances": [
    {
      "content": "[BASE64 DATA - 748 chars]"
    }
  ],
  "parameters": {
    "confidenceThreshold": 0,
    "maxPredictions": 5
  }
}
Direct Vertex AI call failed: Error: 3 INVALID_ARGUMENT: 
    at callErrorFromStatus (/Users/gabe/VEXUS/node_modules/@grpc/grpc-js/build/src/call.js:31:19)
    at Object.onReceiveStatus (/Users/gabe/VEXUS/node_modules/@grpc/grpc-js/build/src/client.js:192:76)
    at Object.onReceiveStatus (/Users/gabe/VEXUS/node_modules/@grpc/grpc-js/build/src/client-interceptors.js:360:141)
    at Object.onReceiveStatus (/Users/gabe/VEXUS/node_modules/@grpc/grpc-js/build/src/client-interceptors.js:323:181)
    at /Users/gabe/VEXUS/node_modules/@grpc/grpc-js/build/src/resolving-call.js:94:78
    at process.processTicksAndRejections (node:internal/process/task_queues:77:11)
for call at
    at ServiceClientImpl.makeUnaryRequest (/Users/gabe/VEXUS/node_modules/@grpc/grpc-js/build/src/client.js:160:32)
    at ServiceClientImpl.<anonymous> (/Users/gabe/VEXUS/node_modules/@grpc/grpc-js/build/src/make-client.js:105:19)
    at /Users/gabe/VEXUS/node_modules/@google-cloud/aiplatform/build/src/v1/prediction_service_client.js:219:29
    at /Users/gabe/VEXUS/node_modules/google-gax/build/src/normalCalls/timeout.js:44:16
    at OngoingCallPromise.call (/Users/gabe/VEXUS/node_modules/google-gax/build/src/call.js:67:27)
    at NormalApiCaller.call (/Users/gabe/VEXUS/node_modules/google-gax/build/src/normalCalls/normalApiCaller.js:34:19)
    at /Users/gabe/VEXUS/node_modules/google-gax/build/src/createApiCall.js:84:30
    at process.processTicksAndRejections (node:internal/process/task_queues:95:5) {
  code: 3,
  details: '',
  metadata: Metadata {
    internalRepr: Map(3) {
      'endpoint-load-metrics-bin' => [Array],
      'grpc-server-stats-bin' => [Array],
      'pc-high-bwd-bin' => [Array]
    },
    options: {}
  }
}
[DIAGNOSTIC] DIRECT_ERROR - portal
[DIAGNOSTIC] Error: 3 INVALID_ARGUMENT: 
[DIAGNOSTIC] Stack: Error: 3 INVALID_ARGUMENT: 
    at callErrorFromStatus (/Users/gabe/VEXUS/node_modules/@grpc/grpc-js/build/src/call.js:31:19)
    at Object.onReceiveStatus (/Users/gabe/VEXUS/node_modules/@grpc/grpc-js/build/src/client.js:192:76)
    at Object.onReceiveStatus (/Users/gabe/VEXUS/node_modules/@grpc/grpc-js/build/src/client-interceptors.js:360:141)
    at Object.onReceiveStatus (/Users/gabe/VEXUS/node_modules/@grpc/grpc-js/build/src/client-interceptors.js:323:181)
    at /Users/gabe/VEXUS/node_modules/@grpc/grpc-js/build/src/resolving-call.js:94:78
    at process.processTicksAndRejections (node:internal/process/task_queues:77:11)
for call at
    at ServiceClientImpl.makeUnaryRequest (/Users/gabe/VEXUS/node_modules/@grpc/grpc-js/build/src/client.js:160:32)
    at ServiceClientImpl.<anonymous> (/Users/gabe/VEXUS/node_modules/@grpc/grpc-js/build/src/make-client.js:105:19)
    at /Users/gabe/VEXUS/node_modules/@google-cloud/aiplatform/build/src/v1/prediction_service_client.js:219:29
    at /Users/gabe/VEXUS/node_modules/google-gax/build/src/normalCalls/timeout.js:44:16
    at OngoingCallPromise.call (/Users/gabe/VEXUS/node_modules/google-gax/build/src/call.js:67:27)
    at NormalApiCaller.call (/Users/gabe/VEXUS/node_modules/google-gax/build/src/normalCalls/normalApiCaller.js:34:19)
    at /Users/gabe/VEXUS/node_modules/google-gax/build/src/createApiCall.js:84:30
    at process.processTicksAndRejections (node:internal/process/task_queues:95:5)
Scheduling shutdown for portal endpoint in 5 minutes
Returning prediction error after both services failed
Prediction request completed in 6558ms
[2025-03-08T09:46:44.416Z] Requesting: /api/predict
Received prediction request
Prediction request for renal vein
Processing image from instances array
Preparing image for prediction, type: image/jpeg
Image content appears to be already in base64 format without prefix
Image prepared for prediction, mime type: image/jpeg
Calling on-demand service for prediction
[DIAGNOSTIC] REQUEST - renal
[DIAGNOSTIC] Data: {
  "veinType": "renal",
  "imageType": "image/jpeg",
  "hasInstances": true,
  "instanceCount": 1,
  "parameters": {
    "confidenceThreshold": 0,
    "maxPredictions": 5
  }
}
Getting credentials from Secret Manager: projects/plucky-weaver-450819-k7/secrets/KEY/versions/latest
[DIAGNOSTIC] ONDEMAND_REQUEST - renal
[DIAGNOSTIC] Data: {
  "instances": [
    {
      "content": "[BASE64 DATA - 748 chars]"
    }
  ],
  "parameters": {
    "confidenceThreshold": 0,
    "maxPredictions": 5
  },
  "metadata": {
    "veinType": "renal",
    "imageType": "image/jpeg",
    "timestamp": 1741427204528
  }
}
Making API call to https://endpoints-on-demand-456295042668.us-central1.run.app (attempt 1/3)
API call attempt 1 failed: API call failed with status 404: <!doctype html>
<html lang=en>
<title>404 Not Found</title>
<h1>Not Found</h1>
<p>The requested URL was not found on the server. If you entered the URL manually please check your spelling and try again.</p>

Waiting 2000ms before retry...
Making API call to https://endpoints-on-demand-456295042668.us-central1.run.app (attempt 2/3)
API call attempt 2 failed: API call failed with status 404: <!doctype html>
<html lang=en>
<title>404 Not Found</title>
<h1>Not Found</h1>
<p>The requested URL was not found on the server. If you entered the URL manually please check your spelling and try again.</p>

Waiting 4000ms before retry...
Making API call to https://endpoints-on-demand-456295042668.us-central1.run.app (attempt 3/3)
API call attempt 3 failed: API call failed with status 404: <!doctype html>
<html lang=en>
<title>404 Not Found</title>
<h1>Not Found</h1>
<p>The requested URL was not found on the server. If you entered the URL manually please check your spelling and try again.</p>

On-demand service error: Error: API call failed with status 404: <!doctype html>
<html lang=en>
<title>404 Not Found</title>
<h1>Not Found</h1>
<p>The requested URL was not found on the server. If you entered the URL manually please check your spelling and try again.</p>

    at makeApiCallWithRetry (file:///Users/gabe/VEXUS/server.js:1169:23)
    at process.processTicksAndRejections (node:internal/process/task_queues:95:5)
    at async file:///Users/gabe/VEXUS/server.js:521:28
[DIAGNOSTIC] ONDEMAND_ERROR - renal
[DIAGNOSTIC] Error: API call failed with status 404: <!doctype html>
<html lang=en>
<title>404 Not Found</title>
<h1>Not Found</h1>
<p>The requested URL was not found on the server. If you entered the URL manually please check your spelling and try again.</p>

[DIAGNOSTIC] Stack: Error: API call failed with status 404: <!doctype html>
<html lang=en>
<title>404 Not Found</title>
<h1>Not Found</h1>
<p>The requested URL was not found on the server. If you entered the URL manually please check your spelling and try again.</p>

    at makeApiCallWithRetry (file:///Users/gabe/VEXUS/server.js:1169:23)
    at process.processTicksAndRejections (node:internal/process/task_queues:95:5)
    at async file:///Users/gabe/VEXUS/server.js:521:28
Falling back to direct Vertex AI call
Sending direct prediction request to endpoint: projects/456295042668/locations/us-central1/endpoints/1148704877514326016
[DIAGNOSTIC] DIRECT_REQUEST - renal
[DIAGNOSTIC] Data: {
  "endpoint": "projects/456295042668/locations/us-central1/endpoints/1148704877514326016",
  "instances": [
    {
      "content": "[BASE64 DATA - 748 chars]"
    }
  ],
  "parameters": {
    "confidenceThreshold": 0,
    "maxPredictions": 5
  }
}
Direct Vertex AI call failed: Error: 3 INVALID_ARGUMENT: 
    at callErrorFromStatus (/Users/gabe/VEXUS/node_modules/@grpc/grpc-js/build/src/call.js:31:19)
    at Object.onReceiveStatus (/Users/gabe/VEXUS/node_modules/@grpc/grpc-js/build/src/client.js:192:76)
    at Object.onReceiveStatus (/Users/gabe/VEXUS/node_modules/@grpc/grpc-js/build/src/client-interceptors.js:360:141)
    at Object.onReceiveStatus (/Users/gabe/VEXUS/node_modules/@grpc/grpc-js/build/src/client-interceptors.js:323:181)
    at /Users/gabe/VEXUS/node_modules/@grpc/grpc-js/build/src/resolving-call.js:94:78
    at process.processTicksAndRejections (node:internal/process/task_queues:77:11)
for call at
    at ServiceClientImpl.makeUnaryRequest (/Users/gabe/VEXUS/node_modules/@grpc/grpc-js/build/src/client.js:160:32)
    at ServiceClientImpl.<anonymous> (/Users/gabe/VEXUS/node_modules/@grpc/grpc-js/build/src/make-client.js:105:19)
    at /Users/gabe/VEXUS/node_modules/@google-cloud/aiplatform/build/src/v1/prediction_service_client.js:219:29
    at /Users/gabe/VEXUS/node_modules/google-gax/build/src/normalCalls/timeout.js:44:16
    at OngoingCallPromise.call (/Users/gabe/VEXUS/node_modules/google-gax/build/src/call.js:67:27)
    at NormalApiCaller.call (/Users/gabe/VEXUS/node_modules/google-gax/build/src/normalCalls/normalApiCaller.js:34:19)
    at /Users/gabe/VEXUS/node_modules/google-gax/build/src/createApiCall.js:84:30
    at process.processTicksAndRejections (node:internal/process/task_queues:95:5) {
  code: 3,
  details: '',
  metadata: Metadata {
    internalRepr: Map(3) {
      'endpoint-load-metrics-bin' => [Array],
      'grpc-server-stats-bin' => [Array],
      'pc-high-bwd-bin' => [Array]
    },
    options: {}
  }
}
[DIAGNOSTIC] DIRECT_ERROR - renal
[DIAGNOSTIC] Error: 3 INVALID_ARGUMENT: 
[DIAGNOSTIC] Stack: Error: 3 INVALID_ARGUMENT: 
    at callErrorFromStatus (/Users/gabe/VEXUS/node_modules/@grpc/grpc-js/build/src/call.js:31:19)
    at Object.onReceiveStatus (/Users/gabe/VEXUS/node_modules/@grpc/grpc-js/build/src/client.js:192:76)
    at Object.onReceiveStatus (/Users/gabe/VEXUS/node_modules/@grpc/grpc-js/build/src/client-interceptors.js:360:141)
    at Object.onReceiveStatus (/Users/gabe/VEXUS/node_modules/@grpc/grpc-js/build/src/client-interceptors.js:323:181)
    at /Users/gabe/VEXUS/node_modules/@grpc/grpc-js/build/src/resolving-call.js:94:78
    at process.processTicksAndRejections (node:internal/process/task_queues:77:11)
for call at
    at ServiceClientImpl.makeUnaryRequest (/Users/gabe/VEXUS/node_modules/@grpc/grpc-js/build/src/client.js:160:32)
    at ServiceClientImpl.<anonymous> (/Users/gabe/VEXUS/node_modules/@grpc/grpc-js/build/src/make-client.js:105:19)
    at /Users/gabe/VEXUS/node_modules/@google-cloud/aiplatform/build/src/v1/prediction_service_client.js:219:29
    at /Users/gabe/VEXUS/node_modules/google-gax/build/src/normalCalls/timeout.js:44:16
    at OngoingCallPromise.call (/Users/gabe/VEXUS/node_modules/google-gax/build/src/call.js:67:27)
    at NormalApiCaller.call (/Users/gabe/VEXUS/node_modules/google-gax/build/src/normalCalls/normalApiCaller.js:34:19)
    at /Users/gabe/VEXUS/node_modules/google-gax/build/src/createApiCall.js:84:30
    at process.processTicksAndRejections (node:internal/process/task_queues:95:5)
Scheduling shutdown for renal endpoint in 5 minutes
Returning prediction error after both services failed
Prediction request completed in 6422ms
[2025-03-08T10:00:41.396Z] Requesting: /api/local-health
[2025-03-08T10:00:49.697Z] Requesting: /api/predict
Received prediction request
Prediction request for hepatic vein
Processing image from instances array
Preparing image for prediction, type: image/jpeg
Image content appears to be already in base64 format without prefix
Image prepared for prediction, mime type: image/jpeg
Calling on-demand service for prediction
[DIAGNOSTIC] REQUEST - hepatic
[DIAGNOSTIC] Data: {
  "veinType": "hepatic",
  "imageType": "image/jpeg",
  "hasInstances": true,
  "instanceCount": 1,
  "parameters": {
    "confidenceThreshold": 0,
    "maxPredictions": 5
  }
}
Getting credentials from Secret Manager: projects/plucky-weaver-450819-k7/secrets/KEY/versions/latest
[DIAGNOSTIC] ONDEMAND_REQUEST - hepatic
[DIAGNOSTIC] Data: {
  "instances": [
    {
      "content": "[BASE64 DATA - 748 chars]"
    }
  ],
  "parameters": {
    "confidenceThreshold": 0,
    "maxPredictions": 5
  },
  "metadata": {
    "veinType": "hepatic",
    "imageType": "image/jpeg",
    "timestamp": 1741428049881
  }
}
Making API call to https://endpoints-on-demand-456295042668.us-central1.run.app (attempt 1/3)
API call attempt 1 failed: API call failed with status 404: <!doctype html>
<html lang=en>
<title>404 Not Found</title>
<h1>Not Found</h1>
<p>The requested URL was not found on the server. If you entered the URL manually please check your spelling and try again.</p>

Waiting 2000ms before retry...
Making API call to https://endpoints-on-demand-456295042668.us-central1.run.app (attempt 2/3)
API call attempt 2 failed: API call failed with status 404: <!doctype html>
<html lang=en>
<title>404 Not Found</title>
<h1>Not Found</h1>
<p>The requested URL was not found on the server. If you entered the URL manually please check your spelling and try again.</p>

Waiting 4000ms before retry...
Making API call to https://endpoints-on-demand-456295042668.us-central1.run.app (attempt 3/3)
API call attempt 3 failed: API call failed with status 404: <!doctype html>
<html lang=en>
<title>404 Not Found</title>
<h1>Not Found</h1>
<p>The requested URL was not found on the server. If you entered the URL manually please check your spelling and try again.</p>

On-demand service error: Error: API call failed with status 404: <!doctype html>
<html lang=en>
<title>404 Not Found</title>
<h1>Not Found</h1>
<p>The requested URL was not found on the server. If you entered the URL manually please check your spelling and try again.</p>

    at makeApiCallWithRetry (file:///Users/gabe/VEXUS/server.js:1169:23)
    at process.processTicksAndRejections (node:internal/process/task_queues:95:5)
    at async file:///Users/gabe/VEXUS/server.js:521:28
[DIAGNOSTIC] ONDEMAND_ERROR - hepatic
[DIAGNOSTIC] Error: API call failed with status 404: <!doctype html>
<html lang=en>
<title>404 Not Found</title>
<h1>Not Found</h1>
<p>The requested URL was not found on the server. If you entered the URL manually please check your spelling and try again.</p>

[DIAGNOSTIC] Stack: Error: API call failed with status 404: <!doctype html>
<html lang=en>
<title>404 Not Found</title>
<h1>Not Found</h1>
<p>The requested URL was not found on the server. If you entered the URL manually please check your spelling and try again.</p>

    at makeApiCallWithRetry (file:///Users/gabe/VEXUS/server.js:1169:23)
    at process.processTicksAndRejections (node:internal/process/task_queues:95:5)
    at async file:///Users/gabe/VEXUS/server.js:521:28
Falling back to direct Vertex AI call
Sending direct prediction request to endpoint: projects/456295042668/locations/us-central1/endpoints/8159951878260523008
[DIAGNOSTIC] DIRECT_REQUEST - hepatic
[DIAGNOSTIC] Data: {
  "endpoint": "projects/456295042668/locations/us-central1/endpoints/8159951878260523008",
  "instances": [
    {
      "content": "[BASE64 DATA - 748 chars]"
    }
  ],
  "parameters": {
    "confidenceThreshold": 0,
    "maxPredictions": 5
  }
}
Direct Vertex AI call failed: Error: 3 INVALID_ARGUMENT: 
    at callErrorFromStatus (/Users/gabe/VEXUS/node_modules/@grpc/grpc-js/build/src/call.js:31:19)
    at Object.onReceiveStatus (/Users/gabe/VEXUS/node_modules/@grpc/grpc-js/build/src/client.js:192:76)
    at Object.onReceiveStatus (/Users/gabe/VEXUS/node_modules/@grpc/grpc-js/build/src/client-interceptors.js:360:141)
    at Object.onReceiveStatus (/Users/gabe/VEXUS/node_modules/@grpc/grpc-js/build/src/client-interceptors.js:323:181)
    at /Users/gabe/VEXUS/node_modules/@grpc/grpc-js/build/src/resolving-call.js:94:78
    at process.processTicksAndRejections (node:internal/process/task_queues:77:11)
for call at
    at ServiceClientImpl.makeUnaryRequest (/Users/gabe/VEXUS/node_modules/@grpc/grpc-js/build/src/client.js:160:32)
    at ServiceClientImpl.<anonymous> (/Users/gabe/VEXUS/node_modules/@grpc/grpc-js/build/src/make-client.js:105:19)
    at /Users/gabe/VEXUS/node_modules/@google-cloud/aiplatform/build/src/v1/prediction_service_client.js:219:29
    at /Users/gabe/VEXUS/node_modules/google-gax/build/src/normalCalls/timeout.js:44:16
    at OngoingCallPromise.call (/Users/gabe/VEXUS/node_modules/google-gax/build/src/call.js:67:27)
    at NormalApiCaller.call (/Users/gabe/VEXUS/node_modules/google-gax/build/src/normalCalls/normalApiCaller.js:34:19)
    at /Users/gabe/VEXUS/node_modules/google-gax/build/src/createApiCall.js:84:30
    at process.processTicksAndRejections (node:internal/process/task_queues:95:5) {
  code: 3,
  details: '',
  metadata: Metadata {
    internalRepr: Map(3) {
      'endpoint-load-metrics-bin' => [Array],
      'grpc-server-stats-bin' => [Array],
      'pc-high-bwd-bin' => [Array]
    },
    options: {}
  }
}
[DIAGNOSTIC] DIRECT_ERROR - hepatic
[DIAGNOSTIC] Error: 3 INVALID_ARGUMENT: 
[DIAGNOSTIC] Stack: Error: 3 INVALID_ARGUMENT: 
    at callErrorFromStatus (/Users/gabe/VEXUS/node_modules/@grpc/grpc-js/build/src/call.js:31:19)
    at Object.onReceiveStatus (/Users/gabe/VEXUS/node_modules/@grpc/grpc-js/build/src/client.js:192:76)
    at Object.onReceiveStatus (/Users/gabe/VEXUS/node_modules/@grpc/grpc-js/build/src/client-interceptors.js:360:141)
    at Object.onReceiveStatus (/Users/gabe/VEXUS/node_modules/@grpc/grpc-js/build/src/client-interceptors.js:323:181)
    at /Users/gabe/VEXUS/node_modules/@grpc/grpc-js/build/src/resolving-call.js:94:78
    at process.processTicksAndRejections (node:internal/process/task_queues:77:11)
for call at
    at ServiceClientImpl.makeUnaryRequest (/Users/gabe/VEXUS/node_modules/@grpc/grpc-js/build/src/client.js:160:32)
    at ServiceClientImpl.<anonymous> (/Users/gabe/VEXUS/node_modules/@grpc/grpc-js/build/src/make-client.js:105:19)
    at /Users/gabe/VEXUS/node_modules/@google-cloud/aiplatform/build/src/v1/prediction_service_client.js:219:29
    at /Users/gabe/VEXUS/node_modules/google-gax/build/src/normalCalls/timeout.js:44:16
    at OngoingCallPromise.call (/Users/gabe/VEXUS/node_modules/google-gax/build/src/call.js:67:27)
    at NormalApiCaller.call (/Users/gabe/VEXUS/node_modules/google-gax/build/src/normalCalls/normalApiCaller.js:34:19)
    at /Users/gabe/VEXUS/node_modules/google-gax/build/src/createApiCall.js:84:30
    at process.processTicksAndRejections (node:internal/process/task_queues:95:5)
Scheduling shutdown for hepatic endpoint in 5 minutes
Returning prediction error after both services failed
Prediction request completed in 6800ms
[2025-03-08T10:00:56.511Z] Requesting: /api/predict
Received prediction request
Prediction request for portal vein
Processing image from instances array
Preparing image for prediction, type: image/jpeg
Image content appears to be already in base64 format without prefix
Image prepared for prediction, mime type: image/jpeg
Calling on-demand service for prediction
[DIAGNOSTIC] REQUEST - portal
[DIAGNOSTIC] Data: {
  "veinType": "portal",
  "imageType": "image/jpeg",
  "hasInstances": true,
  "instanceCount": 1,
  "parameters": {
    "confidenceThreshold": 0,
    "maxPredictions": 5
  }
}
Getting credentials from Secret Manager: projects/plucky-weaver-450819-k7/secrets/KEY/versions/latest
[DIAGNOSTIC] ONDEMAND_REQUEST - portal
[DIAGNOSTIC] Data: {
  "instances": [
    {
      "content": "[BASE64 DATA - 748 chars]"
    }
  ],
  "parameters": {
    "confidenceThreshold": 0,
    "maxPredictions": 5
  },
  "metadata": {
    "veinType": "portal",
    "imageType": "image/jpeg",
    "timestamp": 1741428056679
  }
}
Making API call to https://endpoints-on-demand-456295042668.us-central1.run.app (attempt 1/3)
API call attempt 1 failed: API call failed with status 404: <!doctype html>
<html lang=en>
<title>404 Not Found</title>
<h1>Not Found</h1>
<p>The requested URL was not found on the server. If you entered the URL manually please check your spelling and try again.</p>

Waiting 2000ms before retry...
Making API call to https://endpoints-on-demand-456295042668.us-central1.run.app (attempt 2/3)
API call attempt 2 failed: API call failed with status 404: <!doctype html>
<html lang=en>
<title>404 Not Found</title>
<h1>Not Found</h1>
<p>The requested URL was not found on the server. If you entered the URL manually please check your spelling and try again.</p>

Waiting 4000ms before retry...
Making API call to https://endpoints-on-demand-456295042668.us-central1.run.app (attempt 3/3)
API call attempt 3 failed: API call failed with status 404: <!doctype html>
<html lang=en>
<title>404 Not Found</title>
<h1>Not Found</h1>
<p>The requested URL was not found on the server. If you entered the URL manually please check your spelling and try again.</p>

On-demand service error: Error: API call failed with status 404: <!doctype html>
<html lang=en>
<title>404 Not Found</title>
<h1>Not Found</h1>
<p>The requested URL was not found on the server. If you entered the URL manually please check your spelling and try again.</p>

    at makeApiCallWithRetry (file:///Users/gabe/VEXUS/server.js:1169:23)
    at process.processTicksAndRejections (node:internal/process/task_queues:95:5)
    at async file:///Users/gabe/VEXUS/server.js:521:28
[DIAGNOSTIC] ONDEMAND_ERROR - portal
[DIAGNOSTIC] Error: API call failed with status 404: <!doctype html>
<html lang=en>
<title>404 Not Found</title>
<h1>Not Found</h1>
<p>The requested URL was not found on the server. If you entered the URL manually please check your spelling and try again.</p>

[DIAGNOSTIC] Stack: Error: API call failed with status 404: <!doctype html>
<html lang=en>
<title>404 Not Found</title>
<h1>Not Found</h1>
<p>The requested URL was not found on the server. If you entered the URL manually please check your spelling and try again.</p>

    at makeApiCallWithRetry (file:///Users/gabe/VEXUS/server.js:1169:23)
    at process.processTicksAndRejections (node:internal/process/task_queues:95:5)
    at async file:///Users/gabe/VEXUS/server.js:521:28
Falling back to direct Vertex AI call
Sending direct prediction request to endpoint: projects/456295042668/locations/us-central1/endpoints/2970410926785691648
[DIAGNOSTIC] DIRECT_REQUEST - portal
[DIAGNOSTIC] Data: {
  "endpoint": "projects/456295042668/locations/us-central1/endpoints/2970410926785691648",
  "instances": [
    {
      "content": "[BASE64 DATA - 748 chars]"
    }
  ],
  "parameters": {
    "confidenceThreshold": 0,
    "maxPredictions": 5
  }
}
Direct Vertex AI call failed: Error: 3 INVALID_ARGUMENT: 
    at callErrorFromStatus (/Users/gabe/VEXUS/node_modules/@grpc/grpc-js/build/src/call.js:31:19)
    at Object.onReceiveStatus (/Users/gabe/VEXUS/node_modules/@grpc/grpc-js/build/src/client.js:192:76)
    at Object.onReceiveStatus (/Users/gabe/VEXUS/node_modules/@grpc/grpc-js/build/src/client-interceptors.js:360:141)
    at Object.onReceiveStatus (/Users/gabe/VEXUS/node_modules/@grpc/grpc-js/build/src/client-interceptors.js:323:181)
    at /Users/gabe/VEXUS/node_modules/@grpc/grpc-js/build/src/resolving-call.js:94:78
    at process.processTicksAndRejections (node:internal/process/task_queues:77:11)
for call at
    at ServiceClientImpl.makeUnaryRequest (/Users/gabe/VEXUS/node_modules/@grpc/grpc-js/build/src/client.js:160:32)
    at ServiceClientImpl.<anonymous> (/Users/gabe/VEXUS/node_modules/@grpc/grpc-js/build/src/make-client.js:105:19)
    at /Users/gabe/VEXUS/node_modules/@google-cloud/aiplatform/build/src/v1/prediction_service_client.js:219:29
    at /Users/gabe/VEXUS/node_modules/google-gax/build/src/normalCalls/timeout.js:44:16
    at OngoingCallPromise.call (/Users/gabe/VEXUS/node_modules/google-gax/build/src/call.js:67:27)
    at NormalApiCaller.call (/Users/gabe/VEXUS/node_modules/google-gax/build/src/normalCalls/normalApiCaller.js:34:19)
    at /Users/gabe/VEXUS/node_modules/google-gax/build/src/createApiCall.js:84:30
    at process.processTicksAndRejections (node:internal/process/task_queues:95:5) {
  code: 3,
  details: '',
  metadata: Metadata {
    internalRepr: Map(3) {
      'endpoint-load-metrics-bin' => [Array],
      'grpc-server-stats-bin' => [Array],
      'pc-high-bwd-bin' => [Array]
    },
    options: {}
  }
}
[DIAGNOSTIC] DIRECT_ERROR - portal
[DIAGNOSTIC] Error: 3 INVALID_ARGUMENT: 
[DIAGNOSTIC] Stack: Error: 3 INVALID_ARGUMENT: 
    at callErrorFromStatus (/Users/gabe/VEXUS/node_modules/@grpc/grpc-js/build/src/call.js:31:19)
    at Object.onReceiveStatus (/Users/gabe/VEXUS/node_modules/@grpc/grpc-js/build/src/client.js:192:76)
    at Object.onReceiveStatus (/Users/gabe/VEXUS/node_modules/@grpc/grpc-js/build/src/client-interceptors.js:360:141)
    at Object.onReceiveStatus (/Users/gabe/VEXUS/node_modules/@grpc/grpc-js/build/src/client-interceptors.js:323:181)
    at /Users/gabe/VEXUS/node_modules/@grpc/grpc-js/build/src/resolving-call.js:94:78
    at process.processTicksAndRejections (node:internal/process/task_queues:77:11)
for call at
    at ServiceClientImpl.makeUnaryRequest (/Users/gabe/VEXUS/node_modules/@grpc/grpc-js/build/src/client.js:160:32)
    at ServiceClientImpl.<anonymous> (/Users/gabe/VEXUS/node_modules/@grpc/grpc-js/build/src/make-client.js:105:19)
    at /Users/gabe/VEXUS/node_modules/@google-cloud/aiplatform/build/src/v1/prediction_service_client.js:219:29
    at /Users/gabe/VEXUS/node_modules/google-gax/build/src/normalCalls/timeout.js:44:16
    at OngoingCallPromise.call (/Users/gabe/VEXUS/node_modules/google-gax/build/src/call.js:67:27)
    at NormalApiCaller.call (/Users/gabe/VEXUS/node_modules/google-gax/build/src/normalCalls/normalApiCaller.js:34:19)
    at /Users/gabe/VEXUS/node_modules/google-gax/build/src/createApiCall.js:84:30
    at process.processTicksAndRejections (node:internal/process/task_queues:95:5)
Scheduling shutdown for portal endpoint in 5 minutes
Returning prediction error after both services failed
Prediction request completed in 6908ms
[2025-03-08T10:01:03.426Z] Requesting: /api/predict
Received prediction request
Prediction request for renal vein
Processing image from instances array
Preparing image for prediction, type: image/jpeg
Image content appears to be already in base64 format without prefix
Image prepared for prediction, mime type: image/jpeg
Calling on-demand service for prediction
[DIAGNOSTIC] REQUEST - renal
[DIAGNOSTIC] Data: {
  "veinType": "renal",
  "imageType": "image/jpeg",
  "hasInstances": true,
  "instanceCount": 1,
  "parameters": {
    "confidenceThreshold": 0,
    "maxPredictions": 5
  }
}
Getting credentials from Secret Manager: projects/plucky-weaver-450819-k7/secrets/KEY/versions/latest
[DIAGNOSTIC] ONDEMAND_REQUEST - renal
[DIAGNOSTIC] Data: {
  "instances": [
    {
      "content": "[BASE64 DATA - 748 chars]"
    }
  ],
  "parameters": {
    "confidenceThreshold": 0,
    "maxPredictions": 5
  },
  "metadata": {
    "veinType": "renal",
    "imageType": "image/jpeg",
    "timestamp": 1741428063610
  }
}
Making API call to https://endpoints-on-demand-456295042668.us-central1.run.app (attempt 1/3)
API call attempt 1 failed: API call failed with status 404: <!doctype html>
<html lang=en>
<title>404 Not Found</title>
<h1>Not Found</h1>
<p>The requested URL was not found on the server. If you entered the URL manually please check your spelling and try again.</p>

Waiting 2000ms before retry...
Making API call to https://endpoints-on-demand-456295042668.us-central1.run.app (attempt 2/3)
API call attempt 2 failed: API call failed with status 404: <!doctype html>
<html lang=en>
<title>404 Not Found</title>
<h1>Not Found</h1>
<p>The requested URL was not found on the server. If you entered the URL manually please check your spelling and try again.</p>

Waiting 4000ms before retry...
Making API call to https://endpoints-on-demand-456295042668.us-central1.run.app (attempt 3/3)
API call attempt 3 failed: API call failed with status 404: <!doctype html>
<html lang=en>
<title>404 Not Found</title>
<h1>Not Found</h1>
<p>The requested URL was not found on the server. If you entered the URL manually please check your spelling and try again.</p>

On-demand service error: Error: API call failed with status 404: <!doctype html>
<html lang=en>
<title>404 Not Found</title>
<h1>Not Found</h1>
<p>The requested URL was not found on the server. If you entered the URL manually please check your spelling and try again.</p>

    at makeApiCallWithRetry (file:///Users/gabe/VEXUS/server.js:1169:23)
    at process.processTicksAndRejections (node:internal/process/task_queues:95:5)
    at async file:///Users/gabe/VEXUS/server.js:521:28
[DIAGNOSTIC] ONDEMAND_ERROR - renal
[DIAGNOSTIC] Error: API call failed with status 404: <!doctype html>
<html lang=en>
<title>404 Not Found</title>
<h1>Not Found</h1>
<p>The requested URL was not found on the server. If you entered the URL manually please check your spelling and try again.</p>

[DIAGNOSTIC] Stack: Error: API call failed with status 404: <!doctype html>
<html lang=en>
<title>404 Not Found</title>
<h1>Not Found</h1>
<p>The requested URL was not found on the server. If you entered the URL manually please check your spelling and try again.</p>

    at makeApiCallWithRetry (file:///Users/gabe/VEXUS/server.js:1169:23)
    at process.processTicksAndRejections (node:internal/process/task_queues:95:5)
    at async file:///Users/gabe/VEXUS/server.js:521:28
Falling back to direct Vertex AI call
Sending direct prediction request to endpoint: projects/456295042668/locations/us-central1/endpoints/1148704877514326016
[DIAGNOSTIC] DIRECT_REQUEST - renal
[DIAGNOSTIC] Data: {
  "endpoint": "projects/456295042668/locations/us-central1/endpoints/1148704877514326016",
  "instances": [
    {
      "content": "[BASE64 DATA - 748 chars]"
    }
  ],
  "parameters": {
    "confidenceThreshold": 0,
    "maxPredictions": 5
  }
}
Direct Vertex AI call failed: Error: 3 INVALID_ARGUMENT: 
    at callErrorFromStatus (/Users/gabe/VEXUS/node_modules/@grpc/grpc-js/build/src/call.js:31:19)
    at Object.onReceiveStatus (/Users/gabe/VEXUS/node_modules/@grpc/grpc-js/build/src/client.js:192:76)
    at Object.onReceiveStatus (/Users/gabe/VEXUS/node_modules/@grpc/grpc-js/build/src/client-interceptors.js:360:141)
    at Object.onReceiveStatus (/Users/gabe/VEXUS/node_modules/@grpc/grpc-js/build/src/client-interceptors.js:323:181)
    at /Users/gabe/VEXUS/node_modules/@grpc/grpc-js/build/src/resolving-call.js:94:78
    at process.processTicksAndRejections (node:internal/process/task_queues:77:11)
for call at
    at ServiceClientImpl.makeUnaryRequest (/Users/gabe/VEXUS/node_modules/@grpc/grpc-js/build/src/client.js:160:32)
    at ServiceClientImpl.<anonymous> (/Users/gabe/VEXUS/node_modules/@grpc/grpc-js/build/src/make-client.js:105:19)
    at /Users/gabe/VEXUS/node_modules/@google-cloud/aiplatform/build/src/v1/prediction_service_client.js:219:29
    at /Users/gabe/VEXUS/node_modules/google-gax/build/src/normalCalls/timeout.js:44:16
    at OngoingCallPromise.call (/Users/gabe/VEXUS/node_modules/google-gax/build/src/call.js:67:27)
    at NormalApiCaller.call (/Users/gabe/VEXUS/node_modules/google-gax/build/src/normalCalls/normalApiCaller.js:34:19)
    at /Users/gabe/VEXUS/node_modules/google-gax/build/src/createApiCall.js:84:30
    at process.processTicksAndRejections (node:internal/process/task_queues:95:5) {
  code: 3,
  details: '',
  metadata: Metadata {
    internalRepr: Map(3) {
      'endpoint-load-metrics-bin' => [Array],
      'grpc-server-stats-bin' => [Array],
      'pc-high-bwd-bin' => [Array]
    },
    options: {}
  }
}
[DIAGNOSTIC] DIRECT_ERROR - renal
[DIAGNOSTIC] Error: 3 INVALID_ARGUMENT: 
[DIAGNOSTIC] Stack: Error: 3 INVALID_ARGUMENT: 
    at callErrorFromStatus (/Users/gabe/VEXUS/node_modules/@grpc/grpc-js/build/src/call.js:31:19)
    at Object.onReceiveStatus (/Users/gabe/VEXUS/node_modules/@grpc/grpc-js/build/src/client.js:192:76)
    at Object.onReceiveStatus (/Users/gabe/VEXUS/node_modules/@grpc/grpc-js/build/src/client-interceptors.js:360:141)
    at Object.onReceiveStatus (/Users/gabe/VEXUS/node_modules/@grpc/grpc-js/build/src/client-interceptors.js:323:181)
    at /Users/gabe/VEXUS/node_modules/@grpc/grpc-js/build/src/resolving-call.js:94:78
    at process.processTicksAndRejections (node:internal/process/task_queues:77:11)
for call at
    at ServiceClientImpl.makeUnaryRequest (/Users/gabe/VEXUS/node_modules/@grpc/grpc-js/build/src/client.js:160:32)
    at ServiceClientImpl.<anonymous> (/Users/gabe/VEXUS/node_modules/@grpc/grpc-js/build/src/make-client.js:105:19)
    at /Users/gabe/VEXUS/node_modules/@google-cloud/aiplatform/build/src/v1/prediction_service_client.js:219:29
    at /Users/gabe/VEXUS/node_modules/google-gax/build/src/normalCalls/timeout.js:44:16
    at OngoingCallPromise.call (/Users/gabe/VEXUS/node_modules/google-gax/build/src/call.js:67:27)
    at NormalApiCaller.call (/Users/gabe/VEXUS/node_modules/google-gax/build/src/normalCalls/normalApiCaller.js:34:19)
    at /Users/gabe/VEXUS/node_modules/google-gax/build/src/createApiCall.js:84:30
    at process.processTicksAndRejections (node:internal/process/task_queues:95:5)
Scheduling shutdown for renal endpoint in 5 minutes
Returning prediction error after both services failed
Prediction request completed in 6446ms
[2025-03-08T10:01:50.341Z] Requesting: /api/predict
Received prediction request
Prediction request for hepatic vein
Processing image from instances array
Preparing image for prediction, type: image/png
Image content appears to be already in base64 format without prefix
Image prepared for prediction, mime type: image/png
Calling on-demand service for prediction
[DIAGNOSTIC] REQUEST - hepatic
[DIAGNOSTIC] Data: {
  "veinType": "hepatic",
  "imageType": "image/png",
  "hasInstances": true,
  "instanceCount": 1,
  "parameters": {
    "confidenceThreshold": 0,
    "maxPredictions": 5
  }
}
Getting credentials from Secret Manager: projects/plucky-weaver-450819-k7/secrets/KEY/versions/latest
[DIAGNOSTIC] ONDEMAND_REQUEST - hepatic
[DIAGNOSTIC] Data: {
  "instances": [
    {
      "content": "[BASE64 DATA - 92 chars]"
    }
  ],
  "parameters": {
    "confidenceThreshold": 0,
    "maxPredictions": 5
  },
  "metadata": {
    "veinType": "hepatic",
    "imageType": "image/png",
    "timestamp": 1741428110513
  }
}
Making API call to https://endpoints-on-demand-456295042668.us-central1.run.app (attempt 1/3)
API call attempt 1 failed: API call failed with status 404: <!doctype html>
<html lang=en>
<title>404 Not Found</title>
<h1>Not Found</h1>
<p>The requested URL was not found on the server. If you entered the URL manually please check your spelling and try again.</p>

Waiting 2000ms before retry...
Making API call to https://endpoints-on-demand-456295042668.us-central1.run.app (attempt 2/3)
API call attempt 2 failed: API call failed with status 404: <!doctype html>
<html lang=en>
<title>404 Not Found</title>
<h1>Not Found</h1>
<p>The requested URL was not found on the server. If you entered the URL manually please check your spelling and try again.</p>

Waiting 4000ms before retry...
Making API call to https://endpoints-on-demand-456295042668.us-central1.run.app (attempt 3/3)
API call attempt 3 failed: API call failed with status 404: <!doctype html>
<html lang=en>
<title>404 Not Found</title>
<h1>Not Found</h1>
<p>The requested URL was not found on the server. If you entered the URL manually please check your spelling and try again.</p>

On-demand service error: Error: API call failed with status 404: <!doctype html>
<html lang=en>
<title>404 Not Found</title>
<h1>Not Found</h1>
<p>The requested URL was not found on the server. If you entered the URL manually please check your spelling and try again.</p>

    at makeApiCallWithRetry (file:///Users/gabe/VEXUS/server.js:1169:23)
    at process.processTicksAndRejections (node:internal/process/task_queues:95:5)
    at async file:///Users/gabe/VEXUS/server.js:521:28
[DIAGNOSTIC] ONDEMAND_ERROR - hepatic
[DIAGNOSTIC] Error: API call failed with status 404: <!doctype html>
<html lang=en>
<title>404 Not Found</title>
<h1>Not Found</h1>
<p>The requested URL was not found on the server. If you entered the URL manually please check your spelling and try again.</p>

[DIAGNOSTIC] Stack: Error: API call failed with status 404: <!doctype html>
<html lang=en>
<title>404 Not Found</title>
<h1>Not Found</h1>
<p>The requested URL was not found on the server. If you entered the URL manually please check your spelling and try again.</p>

    at makeApiCallWithRetry (file:///Users/gabe/VEXUS/server.js:1169:23)
    at process.processTicksAndRejections (node:internal/process/task_queues:95:5)
    at async file:///Users/gabe/VEXUS/server.js:521:28
Falling back to direct Vertex AI call
Sending direct prediction request to endpoint: projects/456295042668/locations/us-central1/endpoints/8159951878260523008
[DIAGNOSTIC] DIRECT_REQUEST - hepatic
[DIAGNOSTIC] Data: {
  "endpoint": "projects/456295042668/locations/us-central1/endpoints/8159951878260523008",
  "instances": [
    {
      "content": "[BASE64 DATA - 92 chars]"
    }
  ],
  "parameters": {
    "confidenceThreshold": 0,
    "maxPredictions": 5
  }
}
Direct Vertex AI call failed: Error: 3 INVALID_ARGUMENT: 
    at callErrorFromStatus (/Users/gabe/VEXUS/node_modules/@grpc/grpc-js/build/src/call.js:31:19)
    at Object.onReceiveStatus (/Users/gabe/VEXUS/node_modules/@grpc/grpc-js/build/src/client.js:192:76)
    at Object.onReceiveStatus (/Users/gabe/VEXUS/node_modules/@grpc/grpc-js/build/src/client-interceptors.js:360:141)
    at Object.onReceiveStatus (/Users/gabe/VEXUS/node_modules/@grpc/grpc-js/build/src/client-interceptors.js:323:181)
    at /Users/gabe/VEXUS/node_modules/@grpc/grpc-js/build/src/resolving-call.js:94:78
    at process.processTicksAndRejections (node:internal/process/task_queues:77:11)
for call at
    at ServiceClientImpl.makeUnaryRequest (/Users/gabe/VEXUS/node_modules/@grpc/grpc-js/build/src/client.js:160:32)
    at ServiceClientImpl.<anonymous> (/Users/gabe/VEXUS/node_modules/@grpc/grpc-js/build/src/make-client.js:105:19)
    at /Users/gabe/VEXUS/node_modules/@google-cloud/aiplatform/build/src/v1/prediction_service_client.js:219:29
    at /Users/gabe/VEXUS/node_modules/google-gax/build/src/normalCalls/timeout.js:44:16
    at OngoingCallPromise.call (/Users/gabe/VEXUS/node_modules/google-gax/build/src/call.js:67:27)
    at NormalApiCaller.call (/Users/gabe/VEXUS/node_modules/google-gax/build/src/normalCalls/normalApiCaller.js:34:19)
    at /Users/gabe/VEXUS/node_modules/google-gax/build/src/createApiCall.js:84:30
    at process.processTicksAndRejections (node:internal/process/task_queues:95:5) {
  code: 3,
  details: '',
  metadata: Metadata {
    internalRepr: Map(3) {
      'endpoint-load-metrics-bin' => [Array],
      'grpc-server-stats-bin' => [Array],
      'pc-high-bwd-bin' => [Array]
    },
    options: {}
  }
}
[DIAGNOSTIC] DIRECT_ERROR - hepatic
[DIAGNOSTIC] Error: 3 INVALID_ARGUMENT: 
[DIAGNOSTIC] Stack: Error: 3 INVALID_ARGUMENT: 
    at callErrorFromStatus (/Users/gabe/VEXUS/node_modules/@grpc/grpc-js/build/src/call.js:31:19)
    at Object.onReceiveStatus (/Users/gabe/VEXUS/node_modules/@grpc/grpc-js/build/src/client.js:192:76)
    at Object.onReceiveStatus (/Users/gabe/VEXUS/node_modules/@grpc/grpc-js/build/src/client-interceptors.js:360:141)
    at Object.onReceiveStatus (/Users/gabe/VEXUS/node_modules/@grpc/grpc-js/build/src/client-interceptors.js:323:181)
    at /Users/gabe/VEXUS/node_modules/@grpc/grpc-js/build/src/resolving-call.js:94:78
    at process.processTicksAndRejections (node:internal/process/task_queues:77:11)
for call at
    at ServiceClientImpl.makeUnaryRequest (/Users/gabe/VEXUS/node_modules/@grpc/grpc-js/build/src/client.js:160:32)
    at ServiceClientImpl.<anonymous> (/Users/gabe/VEXUS/node_modules/@grpc/grpc-js/build/src/make-client.js:105:19)
    at /Users/gabe/VEXUS/node_modules/@google-cloud/aiplatform/build/src/v1/prediction_service_client.js:219:29
    at /Users/gabe/VEXUS/node_modules/google-gax/build/src/normalCalls/timeout.js:44:16
    at OngoingCallPromise.call (/Users/gabe/VEXUS/node_modules/google-gax/build/src/call.js:67:27)
    at NormalApiCaller.call (/Users/gabe/VEXUS/node_modules/google-gax/build/src/normalCalls/normalApiCaller.js:34:19)
    at /Users/gabe/VEXUS/node_modules/google-gax/build/src/createApiCall.js:84:30
    at process.processTicksAndRejections (node:internal/process/task_queues:95:5)
Scheduling shutdown for hepatic endpoint in 5 minutes
Returning prediction error after both services failed
Prediction request completed in 6544ms
Requesting: /calculator.html
Requesting: /html5up-phantom/assets/css/main.css
Requesting: /html5up-phantom/assets/css/fontawesome-all.min.css
Requesting: /html5up-phantom/assets/css/header.css
Requesting: /html5up-phantom/assets/css/sidebar.css
Requesting: /html5up-phantom/assets/css/logo.css
Requesting: /html5up-phantom/assets/js/jquery.min.js
Requesting: /images/vexus-ai-logo.png
Requesting: /images/VEXUS.ATLAS.png
Requesting: /html5up-phantom/assets/js/browser.min.js
Requesting: /html5up-phantom/assets/js/breakpoints.min.js
Requesting: /html5up-phantom/assets/js/main.js
Requesting: /html5up-phantom/assets/js/util.js
Requesting: /favicon.ico
Requesting: /api/preload-endpoint
Requesting: /api/preload-endpoint
Requesting: /api/preload-endpoint
Requesting: /api/health
Requesting: /api/health
Requesting: /api/health
Requesting: /calculator.html
Requesting: /html5up-phantom/assets/css/main.css
Requesting: /html5up-phantom/assets/css/fontawesome-all.min.css
Requesting: /html5up-phantom/assets/css/header.css
Requesting: /html5up-phantom/assets/js/jquery.min.js
Requesting: /html5up-phantom/assets/css/sidebar.css
Requesting: /html5up-phantom/assets/css/logo.css
Requesting: /images/vexus-ai-logo.png
Requesting: /images/VEXUS.ATLAS.png
Requesting: /html5up-phantom/assets/js/browser.min.js
Requesting: /html5up-phantom/assets/js/breakpoints.min.js
Requesting: /html5up-phantom/assets/js/util.js
Requesting: /html5up-phantom/assets/js/main.js
Requesting: /favicon.ico
Requesting: /api/preload-endpoint
Requesting: /api/preload-endpoint
Requesting: /api/preload-endpoint
Requesting: /api/health
Requesting: /api/health
Requesting: /api/health
Requesting: /calculator.html
Requesting: /api/preload-endpoint
Requesting: /api/preload-endpoint
Requesting: /api/preload-endpoint
Requesting: /api/health
Requesting: /api/health
Requesting: /api/health
Requesting: /calculator.html
Requesting: /html5up-phantom/assets/css/main.css
Requesting: /html5up-phantom/assets/css/fontawesome-all.min.css
Requesting: /html5up-phantom/assets/css/header.css
Requesting: /html5up-phantom/assets/css/sidebar.css
Requesting: /html5up-phantom/assets/css/logo.css
Requesting: /images/vexus-ai-logo.png
Requesting: /html5up-phantom/assets/js/jquery.min.js
Requesting: /images/VEXUS.ATLAS.png
Requesting: /html5up-phantom/assets/js/browser.min.js
Requesting: /html5up-phantom/assets/js/breakpoints.min.js
Requesting: /html5up-phantom/assets/js/util.js
Requesting: /html5up-phantom/assets/js/main.js
Requesting: /favicon.ico
Requesting: /api/preload-endpoint
Requesting: /api/preload-endpoint
Requesting: /api/preload-endpoint
Requesting: /calculator.html
Requesting: /api/preload-endpoint
Requesting: /api/preload-endpoint
Requesting: /api/preload-endpoint
Requesting: /api/test-endpoint
Requesting: /api/predict
Requesting: /api/health
Requesting: /api/local-health
Requesting: /api/predict/direct/hepatic
Requesting: /api/predict/direct/portal
Requesting: /api/predict/direct/renal
Requesting: /api/predict/direct/hepatic
Requesting: /api/predict/direct/portal
Requesting: /api/predict/direct/renal
Requesting: /api/local-health
Requesting: /calculator.html
Requesting: /html5up-phantom/assets/css/main.css
Requesting: /html5up-phantom/assets/css/fontawesome-all.min.css
Requesting: /html5up-phantom/assets/css/header.css
Requesting: /html5up-phantom/assets/css/sidebar.css
Requesting: /html5up-phantom/assets/css/logo.css
Requesting: /images/vexus-ai-logo.png
Requesting: /html5up-phantom/assets/js/jquery.min.js
Requesting: /images/VEXUS.ATLAS.png
Requesting: /html5up-phantom/assets/js/breakpoints.min.js
Requesting: /html5up-phantom/assets/js/browser.min.js
Requesting: /html5up-phantom/assets/js/main.js
Requesting: /html5up-phantom/assets/js/util.js
Requesting: /api/preload-endpoint
Requesting: /api/preload-endpoint
Requesting: /api/preload-endpoint
Requesting: /api/test-endpoint
Requesting: /api/predict
Requesting: /api/local-health
Requesting: /api/predict/direct/hepatic
Requesting: /api/predict/direct/portal
Requesting: /api/predict/direct/renal
Requesting: /calculator.html
Requesting: /api/preload-endpoint
Requesting: /api/preload-endpoint
Requesting: /api/preload-endpoint
Requesting: /api/test-endpoint
Requesting: /api/predict
Requesting: /api/predict/direct/hepatic
Requesting: /api/predict/direct/portal
Requesting: /api/predict/direct/renal
Requesting: /api/predict/direct/hepatic
Requesting: /api/predict/direct/portal
Requesting: /api/predict/direct/renal
Requesting: /api/predict/direct/hepatic
Requesting: /api/predict/direct/portal
Requesting: /api/predict/direct/renal
Requesting: /api/predict/direct/hepatic
Requesting: /api/predict/direct/hepatic
Requesting: /api/predict/direct/portal
Requesting: /api/predict/direct/renal
Requesting: /api/local-health
Requesting: /api/local-health
Requesting: /
Requesting: /
Requesting: /calculator.html
Requesting: /html5up-phantom/assets/css/main.css
Requesting: /html5up-phantom/assets/css/fontawesome-all.min.css
Requesting: /html5up-phantom/assets/css/header.css
Requesting: /html5up-phantom/assets/css/sidebar.css
Requesting: /html5up-phantom/assets/css/logo.css
Requesting: /images/vexus-ai-logo.png
Requesting: /html5up-phantom/assets/js/jquery.min.js
Requesting: /images/VEXUS.ATLAS.png
Requesting: /html5up-phantom/assets/js/browser.min.js
Requesting: /html5up-phantom/assets/js/breakpoints.min.js
Requesting: /html5up-phantom/assets/js/util.js
Requesting: /html5up-phantom/assets/js/main.js
Requesting: /api/preload-endpoint
Requesting: /api/preload-endpoint
Requesting: /api/health
Requesting: /api/health
Requesting: /api/health
Requesting: /api/local-health
Requesting: /calculator.html
Requesting: /api/preload-endpoint
Requesting: /api/preload-endpoint
Requesting: /api/preload-endpoint
Requesting: /api/test-endpoint
Requesting: /api/predict
Requesting: /api/test-endpoint
Requesting: /api/predict
Requesting: /api/health
Requesting: /api/test-endpoint
Requesting: /api/health
Requesting: /calculator.html
Requesting: /api/preload-endpoint
Requesting: /api/preload-endpoint
Requesting: /api/preload-endpoint
Requesting: /api/test-endpoint
Requesting: /api/predict
Requesting: /api/predict
Requesting: /api/predict
Requesting: /api/health
Requesting: /api/local-health
Requesting: /api/local-health
Requesting: /api/local-health
Requesting: /api/local-health
Requesting: /api/local-health
Requesting: /api/local-health
Requesting: /api/predict
Requesting: /api/local-health
Requesting: /calculator.html
Requesting: /html5up-phantom/assets/css/main.css
Requesting: /html5up-phantom/assets/css/fontawesome-all.min.css
Requesting: /html5up-phantom/assets/css/header.css
Requesting: /html5up-phantom/assets/css/sidebar.css
Requesting: /html5up-phantom/assets/css/logo.css
Requesting: /images/vexus-ai-logo.png
Requesting: /html5up-phantom/assets/js/jquery.min.js
Requesting: /images/VEXUS.ATLAS.png
Requesting: /html5up-phantom/assets/js/browser.min.js
Requesting: /html5up-phantom/assets/js/util.js
Requesting: /html5up-phantom/assets/js/breakpoints.min.js
Requesting: /html5up-phantom/assets/js/main.js
Requesting: /api/preload-endpoint
Requesting: /api/preload-endpoint
Requesting: /api/preload-endpoint
Requesting: /api/test-endpoint
Requesting: /api/predict
Requesting: /api/preload-endpoint
Requesting: /api/preload-endpoint
Requesting: /api/preload-endpoint
Requesting: /api/predict
Requesting: /api/predict
Requesting: /api/predict
Requesting: /api/preload-endpoint
Requesting: /api/preload-endpoint
Requesting: /api/preload-endpoint
Requesting: /api/predict
Requesting: /api/predict
Requesting: /api/predict
Requesting: /api/preload-endpoint
Requesting: /api/preload-endpoint
Requesting: /api/preload-endpoint
Requesting: /api/predict
Requesting: /api/predict
Requesting: /api/predict
Requesting: /api/preload-endpoint
Requesting: /api/preload-endpoint
Requesting: /api/preload-endpoint
Requesting: /api/predict
Requesting: /api/predict
Requesting: /api/predict
Requesting: /api/predict/direct/hepatic
Requesting: /api/predict/direct/portal
Requesting: /api/predict/direct/renal
Requesting: /api/predict
Requesting: /api/predict
Requesting: /api/predict
Requesting: /api/predict
Requesting: /api/predict
Requesting: /api/predict
Requesting: /api/predict
Requesting: /api/predict
Requesting: /api/predict
Requesting: /api/predict
Requesting: /api/predict
Requesting: /api/predict
Requesting: /api/predict
Requesting: /calculator.html
Requesting: /html5up-phantom/assets/webfonts/fa-solid-900.woff2
Requesting: /api/preload-endpoint
Requesting: /api/preload-endpoint
Requesting: /api/preload-endpoint
Requesting: /api/test-endpoint
Requesting: /api/predict
Requesting: /api/predict
Requesting: /api/predict
Requesting: /api/predict
Requesting: /api/predict
Requesting: /api/predict
Requesting: /calculator.html
Requesting: /html5up-phantom/assets/css/main.css
Requesting: /html5up-phantom/assets/css/fontawesome-all.min.css
Requesting: /html5up-phantom/assets/css/header.css
Requesting: /html5up-phantom/assets/css/logo.css
Requesting: /html5up-phantom/assets/css/sidebar.css
Requesting: /html5up-phantom/assets/js/jquery.min.js
Requesting: /images/vexus-ai-logo.png
Requesting: /images/VEXUS.ATLAS.png
Requesting: /html5up-phantom/assets/js/browser.min.js
Requesting: /html5up-phantom/assets/js/breakpoints.min.js
Requesting: /html5up-phantom/assets/js/util.js
Requesting: /html5up-phantom/assets/js/main.js
Requesting: /api/preload-endpoint
Requesting: /api/preload-endpoint
Requesting: /api/preload-endpoint
Requesting: /api/test-endpoint
Requesting: /api/predict
Requesting: /health
Requesting: /api/predict/direct/hepatic
Requesting: /calculator.html
Requesting: /api/preload-endpoint
Requesting: /api/preload-endpoint
Requesting: /api/preload-endpoint
Requesting: /
Requesting: /api/predict
Requesting: /api/predict
Requesting: /api/predict
Requesting: /api/predict
Requesting: /api/predict
Requesting: /api/predict
Requesting: /calculator.html
Requesting: /html5up-phantom/assets/css/main.css
Requesting: /html5up-phantom/assets/css/fontawesome-all.min.css
Requesting: /html5up-phantom/assets/css/header.css
Requesting: /html5up-phantom/assets/css/sidebar.css
Requesting: /html5up-phantom/assets/css/logo.css
Requesting: /images/vexus-ai-logo.png
Requesting: /html5up-phantom/assets/js/jquery.min.js
Requesting: /images/VEXUS.ATLAS.png
Requesting: /html5up-phantom/assets/js/browser.min.js
Requesting: /html5up-phantom/assets/js/breakpoints.min.js
Requesting: /html5up-phantom/assets/js/util.js
Requesting: /html5up-phantom/assets/js/main.js
Requesting: /api/check-ondemand-status
Requesting: /calculator.html
Requesting: /api/check-ondemand-status
